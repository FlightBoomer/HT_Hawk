; generated by Component: ARM Compiler 5.05 update 1 (build 106) Tool: ArmCC [4d0efa]
; commandline ArmCC [--c99 --list --split_sections --debug -c --asm --interleave -o.\flash\obj\height_ctrl.o --asm_dir=.\Flash\List\ --list_dir=.\Flash\List\ --depend=.\flash\obj\height_ctrl.d --cpu=Cortex-M3 --apcs=interwork -O0 --diag_suppress=9931 -I..\..\Libraries\CMSIS\CM3\CoreSupport -I..\..\Libraries\CMSIS\CM3\DeviceSupport\ST\STM32F10x -I..\..\Libraries\STM32F10x_StdPeriph_Driver\inc -I..\..\Libraries\STM32_USB-FS-Device_Driver\inc -I..\..\User\usb_virture_com -I..\..\User -I..\..\User\bsp -I..\..\User\Driver\IIC -I..\..\User\Driver\LED -I..\..\User\Driver\TIM -I..\..\User\Driver\SPI -I..\..\User\Driver\ADC -I..\..\User\Driver\Delay -I..\..\User\Driver\UART -I..\..\User\Driver\MOTOR -I..\..\User\Driver\PWM_IN -I..\..\User\Driver\EEPROM -I..\..\User\Modules\Modules_mpu6050 -I..\..\User\Modules\Modules_nrf24L01 -I..\..\User\Modules\Modules_hmc5883 -I..\..\User\Algorithm\Algorithm_filter -I..\..\User\Algorithm\Algorithm_math -I..\..\User\Algorithm\Algorithm_sqLite -I..\..\User\Algorithm\Algorithm_quaternion -I..\..\User\Function\MultiRotor_rc -I..\..\User\Function\MultiRotor_app -I..\..\User\Function\MultiRotor_ahrs -I..\..\User\Function\MultiRotor_radio -I..\..\User\Function\MultiRotor_control -I..\..\User\Modules\Modules_oled -I..\..\User\Driver\STMFLASH -I..\..\User\Modules\Modules_ms5611 -I..\..\User\Function\MultiRotor_altitute -I..\..\User\Modules\GPS -I..\..\User\Modules\Modules_ultrasonic -I..\..\User\ANO_DT -I..\..\User\Heigh -IC:\__Electronic_Projects\STM32\HT_Hawk_0528_1\Project\MDK-ARM(uV5)\RTE -IC:\Keil_v5\ARM\PACK\ARM\CMSIS\4.2.0\CMSIS\Include -IC:\Keil_v5\ARM\PACK\Keil\STM32F1xx_DFP\1.0.5\Device\Include -D__MICROLIB -D__UVISION_VERSION=514 -D_RTE_ -DSTM32F10X_HD -DSTM32F10X_HD -DUSE_STDPERIPH_DRIVER --omf_browse=.\flash\obj\height_ctrl.crf ..\..\User\Heigh\height_ctrl.c]
                          THUMB

                          AREA ||i.Baro_Ctrl||, CODE, READONLY, ALIGN=2

                  Baro_Ctrl PROC
;;;263    
;;;264    void Baro_Ctrl(float T,float thr)
000000  e92d47f0          PUSH     {r4-r10,lr}
;;;265    {
000004  4604              MOV      r4,r0
000006  460d              MOV      r5,r1
;;;266    		exp_height_speed = BARO_SPEED *my_deathzoom_2(thr - 500,100)/400.0f; //20这里具体根据自己起飞油门定，油门控制高度+-ULTRA_SPEEDmm / s
000008  4981              LDR      r1,|L1.528|
00000a  4628              MOV      r0,r5
00000c  f7fffffe          BL       __aeabi_fsub
000010  4680              MOV      r8,r0
000012  4980              LDR      r1,|L1.532|
000014  f7fffffe          BL       my_deathzoom_2
000018  4607              MOV      r7,r0
00001a  497f              LDR      r1,|L1.536|
00001c  f7fffffe          BL       __aeabi_fmul
000020  4606              MOV      r6,r0
000022  497e              LDR      r1,|L1.540|
000024  f7fffffe          BL       __aeabi_fdiv
000028  497d              LDR      r1,|L1.544|
00002a  6008              STR      r0,[r1,#0]  ; exp_height_speed
;;;267    		exp_height_speed = LIMIT(exp_height_speed ,-BARO_SPEED,BARO_SPEED);
00002c  497d              LDR      r1,|L1.548|
00002e  487c              LDR      r0,|L1.544|
000030  6800              LDR      r0,[r0,#0]  ; exp_height_speed
000032  f7fffffe          BL       __aeabi_cfcmple
000036  d201              BCS      |L1.60|
000038  487a              LDR      r0,|L1.548|
00003a  e009              B        |L1.80|
                  |L1.60|
00003c  4976              LDR      r1,|L1.536|
00003e  4878              LDR      r0,|L1.544|
000040  6800              LDR      r0,[r0,#0]  ; exp_height_speed
000042  f7fffffe          BL       __aeabi_cfrcmple
000046  d201              BCS      |L1.76|
000048  4873              LDR      r0,|L1.536|
00004a  e001              B        |L1.80|
                  |L1.76|
00004c  4874              LDR      r0,|L1.544|
00004e  6800              LDR      r0,[r0,#0]  ; exp_height_speed
                  |L1.80|
000050  4973              LDR      r1,|L1.544|
000052  6008              STR      r0,[r1,#0]  ; exp_height_speed
;;;268    		
;;;269    		if( exp_height > Baro_MAX_Height )//限定高度，可以根据实际修改
000054  4974              LDR      r1,|L1.552|
000056  4875              LDR      r0,|L1.556|
000058  6800              LDR      r0,[r0,#0]  ; exp_height
00005a  f7fffffe          BL       __aeabi_cfrcmple
00005e  d209              BCS      |L1.116|
;;;270    		{
;;;271    			if( exp_height_speed > 0 )
000060  2100              MOVS     r1,#0
000062  486f              LDR      r0,|L1.544|
000064  6800              LDR      r0,[r0,#0]  ; exp_height_speed
000066  f7fffffe          BL       __aeabi_cfrcmple
00006a  d212              BCS      |L1.146|
;;;272    			{
;;;273    				exp_height_speed = 0;
00006c  2000              MOVS     r0,#0
00006e  496c              LDR      r1,|L1.544|
000070  6008              STR      r0,[r1,#0]  ; exp_height_speed
000072  e00e              B        |L1.146|
                  |L1.116|
;;;274    			}
;;;275    		}
;;;276    		else if( exp_height < Baro_MIN_Height )
000074  496e              LDR      r1,|L1.560|
000076  486d              LDR      r0,|L1.556|
000078  6800              LDR      r0,[r0,#0]  ; exp_height
00007a  f7fffffe          BL       __aeabi_cfcmple
00007e  d208              BCS      |L1.146|
;;;277    		{
;;;278    			if( exp_height_speed < 0 )
000080  2100              MOVS     r1,#0
000082  4867              LDR      r0,|L1.544|
000084  6800              LDR      r0,[r0,#0]  ; exp_height_speed
000086  f7fffffe          BL       __aeabi_cfcmple
00008a  d202              BCS      |L1.146|
;;;279    			{
;;;280    				exp_height_speed = 0;
00008c  2000              MOVS     r0,#0
00008e  4964              LDR      r1,|L1.544|
000090  6008              STR      r0,[r1,#0]  ; exp_height_speed
                  |L1.146|
;;;281    			}
;;;282    		}
;;;283    		
;;;284    		exp_height += exp_height_speed *T;//累积期望高度，因为期望速度可能改变了			
000092  4863              LDR      r0,|L1.544|
000094  6801              LDR      r1,[r0,#0]  ; exp_height_speed
000096  4620              MOV      r0,r4
000098  f7fffffe          BL       __aeabi_fmul
00009c  4606              MOV      r6,r0
00009e  4863              LDR      r0,|L1.556|
0000a0  6801              LDR      r1,[r0,#0]  ; exp_height
0000a2  4630              MOV      r0,r6
0000a4  f7fffffe          BL       __aeabi_fadd
0000a8  4960              LDR      r1,|L1.556|
0000aa  6008              STR      r0,[r1,#0]  ; exp_height
;;;285    		baro_ctrl.err = baro_pid.kp*(exp_height - baro_dis_lpf);//baro_dis_lpfmm 对高度误差乘以Kp
0000ac  4861              LDR      r0,|L1.564|
0000ae  6801              LDR      r1,[r0,#0]  ; baro_dis_lpf
0000b0  485e              LDR      r0,|L1.556|
0000b2  6800              LDR      r0,[r0,#0]  ; exp_height
0000b4  f7fffffe          BL       __aeabi_fsub
0000b8  4606              MOV      r6,r0
0000ba  485f              LDR      r0,|L1.568|
0000bc  6801              LDR      r1,[r0,#0]  ; baro_pid
0000be  4630              MOV      r0,r6
0000c0  f7fffffe          BL       __aeabi_fmul
0000c4  495d              LDR      r1,|L1.572|
0000c6  6008              STR      r0,[r1,#0]  ; baro_ctrl
;;;286    		userdata2[5]=baro_ctrl.err;
0000c8  4608              MOV      r0,r1
0000ca  6800              LDR      r0,[r0,#0]  ; baro_ctrl
0000cc  495c              LDR      r1,|L1.576|
0000ce  6148              STR      r0,[r1,#0x14]  ; userdata2
;;;287    		baro_ctrl.err_i += baro_pid.ki *baro_ctrl.err *T;//对高度误差积分
0000d0  4a5a              LDR      r2,|L1.572|
0000d2  6811              LDR      r1,[r2,#0]  ; baro_ctrl
0000d4  4a58              LDR      r2,|L1.568|
0000d6  6890              LDR      r0,[r2,#8]  ; baro_pid
0000d8  f7fffffe          BL       __aeabi_fmul
0000dc  4607              MOV      r7,r0
0000de  4621              MOV      r1,r4
0000e0  f7fffffe          BL       __aeabi_fmul
0000e4  4606              MOV      r6,r0
0000e6  4855              LDR      r0,|L1.572|
0000e8  68c1              LDR      r1,[r0,#0xc]  ; baro_ctrl
0000ea  4630              MOV      r0,r6
0000ec  f7fffffe          BL       __aeabi_fadd
0000f0  4952              LDR      r1,|L1.572|
0000f2  60c8              STR      r0,[r1,#0xc]  ; baro_ctrl
;;;288    		userdata2[6]=baro_ctrl.err_i = LIMIT(baro_ctrl.err_i,-Thr_Weight *BARO_INT,Thr_Weight *BARO_INT);//积分限幅，融合了油门权重
0000f4  4853              LDR      r0,|L1.580|
0000f6  6800              LDR      r0,[r0,#0]  ; Thr_Weight
0000f8  f0804700          EOR      r7,r0,#0x80000000
0000fc  4946              LDR      r1,|L1.536|
0000fe  4638              MOV      r0,r7
000100  f7fffffe          BL       __aeabi_fmul
000104  4606              MOV      r6,r0
000106  484d              LDR      r0,|L1.572|
000108  68c1              LDR      r1,[r0,#0xc]  ; baro_ctrl
00010a  4630              MOV      r0,r6
00010c  f7fffffe          BL       __aeabi_cfrcmple
000110  d208              BCS      |L1.292|
000112  484c              LDR      r0,|L1.580|
000114  6800              LDR      r0,[r0,#0]  ; Thr_Weight
000116  f0804600          EOR      r6,r0,#0x80000000
00011a  493f              LDR      r1,|L1.536|
00011c  4630              MOV      r0,r6
00011e  f7fffffe          BL       __aeabi_fmul
000122  e013              B        |L1.332|
                  |L1.292|
000124  493c              LDR      r1,|L1.536|
000126  4847              LDR      r0,|L1.580|
000128  6800              LDR      r0,[r0,#0]  ; Thr_Weight
00012a  f7fffffe          BL       __aeabi_fmul
00012e  4606              MOV      r6,r0
000130  4842              LDR      r0,|L1.572|
000132  68c1              LDR      r1,[r0,#0xc]  ; baro_ctrl
000134  4630              MOV      r0,r6
000136  f7fffffe          BL       __aeabi_cfcmple
00013a  d205              BCS      |L1.328|
00013c  4936              LDR      r1,|L1.536|
00013e  4841              LDR      r0,|L1.580|
000140  6800              LDR      r0,[r0,#0]  ; Thr_Weight
000142  f7fffffe          BL       __aeabi_fmul
000146  e001              B        |L1.332|
                  |L1.328|
000148  483c              LDR      r0,|L1.572|
00014a  68c0              LDR      r0,[r0,#0xc]  ; baro_ctrl
                  |L1.332|
00014c  493b              LDR      r1,|L1.572|
00014e  60c8              STR      r0,[r1,#0xc]  ; baro_ctrl
000150  493b              LDR      r1,|L1.576|
000152  6188              STR      r0,[r1,#0x18]  ; userdata2
;;;289    		//对于D，融合了加速度计运算得到的距离	
;;;290    		userdata2[7]=0.4f *(baro_ctrl.err - baro_ctrl.err_old);
000154  4a39              LDR      r2,|L1.572|
000156  6851              LDR      r1,[r2,#4]  ; baro_ctrl
000158  6810              LDR      r0,[r2,#0]  ; baro_ctrl
00015a  f7fffffe          BL       __aeabi_fsub
00015e  4606              MOV      r6,r0
000160  4939              LDR      r1,|L1.584|
000162  f7fffffe          BL       __aeabi_fmul
000166  4936              LDR      r1,|L1.576|
000168  61c8              STR      r0,[r1,#0x1c]  ; userdata2
;;;291    		baro_ctrl.err_d = baro_pid.kd *( 0.6f *(-wz_speed*T) + 0.4f *(baro_ctrl.err - baro_ctrl.err_old) );
00016a  4a34              LDR      r2,|L1.572|
00016c  6851              LDR      r1,[r2,#4]  ; baro_ctrl
00016e  6810              LDR      r0,[r2,#0]  ; baro_ctrl
000170  f7fffffe          BL       __aeabi_fsub
000174  4681              MOV      r9,r0
000176  4934              LDR      r1,|L1.584|
000178  f7fffffe          BL       __aeabi_fmul
00017c  4607              MOV      r7,r0
00017e  4833              LDR      r0,|L1.588|
000180  6800              LDR      r0,[r0,#0]  ; wz_speed
000182  f0804a00          EOR      r10,r0,#0x80000000
000186  4621              MOV      r1,r4
000188  4650              MOV      r0,r10
00018a  f7fffffe          BL       __aeabi_fmul
00018e  4681              MOV      r9,r0
000190  492f              LDR      r1,|L1.592|
000192  f7fffffe          BL       __aeabi_fmul
000196  4680              MOV      r8,r0
000198  4639              MOV      r1,r7
00019a  f7fffffe          BL       __aeabi_fadd
00019e  4606              MOV      r6,r0
0001a0  4825              LDR      r0,|L1.568|
0001a2  6841              LDR      r1,[r0,#4]  ; baro_pid
0001a4  4630              MOV      r0,r6
0001a6  f7fffffe          BL       __aeabi_fmul
0001aa  4924              LDR      r1,|L1.572|
0001ac  6088              STR      r0,[r1,#8]  ; baro_ctrl
;;;292    		userdata2[8]=baro_ctrl.err_d;
0001ae  4608              MOV      r0,r1
0001b0  6880              LDR      r0,[r0,#8]  ; baro_ctrl
0001b2  4923              LDR      r1,|L1.576|
0001b4  6208              STR      r0,[r1,#0x20]  ; userdata2
;;;293    		baro_ctrl.pid_out = baro_ctrl.err + baro_ctrl.err_i + baro_ctrl.err_d;
0001b6  4a21              LDR      r2,|L1.572|
0001b8  68d1              LDR      r1,[r2,#0xc]  ; baro_ctrl
0001ba  6810              LDR      r0,[r2,#0]  ; baro_ctrl
0001bc  f7fffffe          BL       __aeabi_fadd
0001c0  4606              MOV      r6,r0
0001c2  481e              LDR      r0,|L1.572|
0001c4  6881              LDR      r1,[r0,#8]  ; baro_ctrl
0001c6  4630              MOV      r0,r6
0001c8  f7fffffe          BL       __aeabi_fadd
0001cc  491b              LDR      r1,|L1.572|
0001ce  6108              STR      r0,[r1,#0x10]  ; baro_ctrl
;;;294    		baro_ctrl.pid_out = LIMIT(baro_ctrl.pid_out,-300,300);	
0001d0  6908              LDR      r0,[r1,#0x10]  ; baro_ctrl
0001d2  4914              LDR      r1,|L1.548|
0001d4  f7fffffe          BL       __aeabi_cfcmple
0001d8  d201              BCS      |L1.478|
0001da  4812              LDR      r0,|L1.548|
0001dc  e009              B        |L1.498|
                  |L1.478|
0001de  4917              LDR      r1,|L1.572|
0001e0  6908              LDR      r0,[r1,#0x10]  ; baro_ctrl
0001e2  490d              LDR      r1,|L1.536|
0001e4  f7fffffe          BL       __aeabi_cfrcmple
0001e8  d201              BCS      |L1.494|
0001ea  480b              LDR      r0,|L1.536|
0001ec  e001              B        |L1.498|
                  |L1.494|
0001ee  4813              LDR      r0,|L1.572|
0001f0  6900              LDR      r0,[r0,#0x10]  ; baro_ctrl
                  |L1.498|
0001f2  4912              LDR      r1,|L1.572|
0001f4  6108              STR      r0,[r1,#0x10]  ; baro_ctrl
;;;295    		userdata2[9]=baro_ctrl_out = baro_ctrl.pid_out;	
0001f6  4608              MOV      r0,r1
0001f8  6900              LDR      r0,[r0,#0x10]  ; baro_ctrl
0001fa  4916              LDR      r1,|L1.596|
0001fc  6008              STR      r0,[r1,#0]  ; baro_ctrl_out
0001fe  4910              LDR      r1,|L1.576|
000200  6248              STR      r0,[r1,#0x24]  ; userdata2
;;;296    		baro_ctrl.err_old = baro_ctrl.err;
000202  480e              LDR      r0,|L1.572|
000204  6800              LDR      r0,[r0,#0]  ; baro_ctrl
000206  490d              LDR      r1,|L1.572|
000208  6048              STR      r0,[r1,#4]  ; baro_ctrl
;;;297    }
00020a  e8bd87f0          POP      {r4-r10,pc}
;;;298    
                          ENDP

00020e  0000              DCW      0x0000
                  |L1.528|
                          DCD      0x43fa0000
                  |L1.532|
                          DCD      0x42c80000
                  |L1.536|
                          DCD      0x43960000
                  |L1.540|
                          DCD      0x43c80000
                  |L1.544|
                          DCD      exp_height_speed
                  |L1.548|
                          DCD      0xc3960000
                  |L1.552|
                          DCD      0x45fa0000
                  |L1.556|
                          DCD      exp_height
                  |L1.560|
                          DCD      0x447a0000
                  |L1.564|
                          DCD      baro_dis_lpf
                  |L1.568|
                          DCD      baro_pid
                  |L1.572|
                          DCD      baro_ctrl
                  |L1.576|
                          DCD      userdata2
                  |L1.580|
                          DCD      Thr_Weight
                  |L1.584|
                          DCD      0x3ecccccd
                  |L1.588|
                          DCD      wz_speed
                  |L1.592|
                          DCD      0x3f19999a
                  |L1.596|
                          DCD      baro_ctrl_out

                          AREA ||i.Baro_PID_Init||, CODE, READONLY, ALIGN=2

                  Baro_PID_Init PROC
;;;230    
;;;231    void Baro_PID_Init()
000000  4804              LDR      r0,|L2.20|
;;;232    {
;;;233    		baro_pid.kp = 0.15;//气压定高的高度位置环PID，会被EEPROM里的重新赋值的
000002  4905              LDR      r1,|L2.24|
000004  6008              STR      r0,[r1,#0]  ; baro_pid
;;;234    		baro_pid.ki = 0;
000006  2000              MOVS     r0,#0
000008  6088              STR      r0,[r1,#8]  ; baro_pid
;;;235    		baro_pid.kd = 1.5;	//2.5
00000a  f04f507f          MOV      r0,#0x3fc00000
00000e  6048              STR      r0,[r1,#4]  ; baro_pid
;;;236    }
000010  4770              BX       lr
;;;237    
                          ENDP

000012  0000              DCW      0x0000
                  |L2.20|
                          DCD      0x3e19999a
                  |L2.24|
                          DCD      baro_pid

                          AREA ||i.Baro_dataporcess||, CODE, READONLY, ALIGN=2

                  Baro_dataporcess PROC
;;;237    
;;;238    void Baro_dataporcess(float T)
000000  e92d5ff0          PUSH     {r4-r12,lr}
;;;239    {
000004  4604              MOV      r4,r0
;;;240    		float baro_dis_tmp;	
;;;241    		
;;;242    		baro_dis_tmp = Moving_Median(2,5,baro_height);//对超声波测量的距离进行移动中位值滤波
000006  4876              LDR      r0,|L3.480|
000008  2105              MOVS     r1,#5
00000a  6802              LDR      r2,[r0,#0]  ; baro_height
00000c  2002              MOVS     r0,#2
00000e  f7fffffe          BL       Moving_Median
000012  4681              MOV      r9,r0
;;;243    
;;;244    		if( baro_dis_tmp < Baro_MAX_Height )
000014  4973              LDR      r1,|L3.484|
000016  4648              MOV      r0,r9
000018  f7fffffe          BL       __aeabi_cfcmple
00001c  d242              BCS      |L3.164|
;;;245    		{	
;;;246    			if( ABS(baro_dis_tmp - baro_dis_lpf) < 100 )
00001e  4872              LDR      r0,|L3.488|
000020  6801              LDR      r1,[r0,#0]  ; baro_dis_lpf
000022  4648              MOV      r0,r9
000024  f7fffffe          BL       __aeabi_fsub
000028  4606              MOV      r6,r0
00002a  2100              MOVS     r1,#0
00002c  f7fffffe          BL       __aeabi_cfrcmple
000030  d205              BCS      |L3.62|
000032  486d              LDR      r0,|L3.488|
000034  6801              LDR      r1,[r0,#0]  ; baro_dis_lpf
000036  4648              MOV      r0,r9
000038  f7fffffe          BL       __aeabi_fsub
00003c  e006              B        |L3.76|
                  |L3.62|
00003e  486a              LDR      r0,|L3.488|
000040  6801              LDR      r1,[r0,#0]  ; baro_dis_lpf
000042  4648              MOV      r0,r9
000044  f7fffffe          BL       __aeabi_fsub
000048  f0804000          EOR      r0,r0,#0x80000000
                  |L3.76|
00004c  4605              MOV      r5,r0
00004e  4967              LDR      r1,|L3.492|
000050  f7fffffe          BL       __aeabi_cfcmple
000054  d227              BCS      |L3.166|
;;;247    			{	
;;;248    				 baro_dis_lpf += ( 1 / ( 1 + 1 / ( 2.0f *3.14f *T ) ) ) *(baro_dis_tmp - baro_dis_lpf) ;
000056  4864              LDR      r0,|L3.488|
000058  6801              LDR      r1,[r0,#0]  ; baro_dis_lpf
00005a  4648              MOV      r0,r9
00005c  f7fffffe          BL       __aeabi_fsub
000060  4682              MOV      r10,r0
000062  4963              LDR      r1,|L3.496|
000064  4620              MOV      r0,r4
000066  f7fffffe          BL       __aeabi_fmul
00006a  4683              MOV      r11,r0
00006c  4659              MOV      r1,r11
00006e  f04f507e          MOV      r0,#0x3f800000
000072  f7fffffe          BL       __aeabi_fdiv
000076  4680              MOV      r8,r0
000078  f04f517e          MOV      r1,#0x3f800000
00007c  f7fffffe          BL       __aeabi_fadd
000080  4607              MOV      r7,r0
000082  4639              MOV      r1,r7
000084  f04f507e          MOV      r0,#0x3f800000
000088  f7fffffe          BL       __aeabi_fdiv
00008c  4606              MOV      r6,r0
00008e  4651              MOV      r1,r10
000090  f7fffffe          BL       __aeabi_fmul
000094  4605              MOV      r5,r0
000096  4854              LDR      r0,|L3.488|
000098  6801              LDR      r1,[r0,#0]  ; baro_dis_lpf
00009a  4628              MOV      r0,r5
00009c  f7fffffe          BL       __aeabi_fadd
0000a0  4951              LDR      r1,|L3.488|
0000a2  6008              STR      r0,[r1,#0]  ; baro_dis_lpf
                  |L3.164|
0000a4  e06a              B        |L3.380|
                  |L3.166|
;;;249    			}
;;;250    			else if( ABS(baro_dis_tmp - baro_dis_lpf) < 500 )
0000a6  4850              LDR      r0,|L3.488|
0000a8  6801              LDR      r1,[r0,#0]  ; baro_dis_lpf
0000aa  4648              MOV      r0,r9
0000ac  f7fffffe          BL       __aeabi_fsub
0000b0  4606              MOV      r6,r0
0000b2  2100              MOVS     r1,#0
0000b4  f7fffffe          BL       __aeabi_cfrcmple
0000b8  d205              BCS      |L3.198|
0000ba  484b              LDR      r0,|L3.488|
0000bc  6801              LDR      r1,[r0,#0]  ; baro_dis_lpf
0000be  4648              MOV      r0,r9
0000c0  f7fffffe          BL       __aeabi_fsub
0000c4  e006              B        |L3.212|
                  |L3.198|
0000c6  4848              LDR      r0,|L3.488|
0000c8  6801              LDR      r1,[r0,#0]  ; baro_dis_lpf
0000ca  4648              MOV      r0,r9
0000cc  f7fffffe          BL       __aeabi_fsub
0000d0  f0804000          EOR      r0,r0,#0x80000000
                  |L3.212|
0000d4  4605              MOV      r5,r0
0000d6  4947              LDR      r1,|L3.500|
0000d8  f7fffffe          BL       __aeabi_cfcmple
0000dc  d227              BCS      |L3.302|
;;;251    			{
;;;252    				 baro_dis_lpf += ( 1 / ( 1 + 1 / ( 1.0f *3.14f *T ) ) ) *(baro_dis_tmp- baro_dis_lpf) ;
0000de  4842              LDR      r0,|L3.488|
0000e0  6801              LDR      r1,[r0,#0]  ; baro_dis_lpf
0000e2  4648              MOV      r0,r9
0000e4  f7fffffe          BL       __aeabi_fsub
0000e8  4682              MOV      r10,r0
0000ea  4943              LDR      r1,|L3.504|
0000ec  4620              MOV      r0,r4
0000ee  f7fffffe          BL       __aeabi_fmul
0000f2  4683              MOV      r11,r0
0000f4  4659              MOV      r1,r11
0000f6  f04f507e          MOV      r0,#0x3f800000
0000fa  f7fffffe          BL       __aeabi_fdiv
0000fe  4680              MOV      r8,r0
000100  f04f517e          MOV      r1,#0x3f800000
000104  f7fffffe          BL       __aeabi_fadd
000108  4607              MOV      r7,r0
00010a  4639              MOV      r1,r7
00010c  f04f507e          MOV      r0,#0x3f800000
000110  f7fffffe          BL       __aeabi_fdiv
000114  4606              MOV      r6,r0
000116  4651              MOV      r1,r10
000118  f7fffffe          BL       __aeabi_fmul
00011c  4605              MOV      r5,r0
00011e  4832              LDR      r0,|L3.488|
000120  6801              LDR      r1,[r0,#0]  ; baro_dis_lpf
000122  4628              MOV      r0,r5
000124  f7fffffe          BL       __aeabi_fadd
000128  492f              LDR      r1,|L3.488|
00012a  6008              STR      r0,[r1,#0]  ; baro_dis_lpf
00012c  e026              B        |L3.380|
                  |L3.302|
;;;253    			}
;;;254    			else
;;;255    			{
;;;256    				 baro_dis_lpf += ( 1 / ( 1 + 1 / ( 0.5f *3.14f *T ) ) ) *(baro_dis_tmp- baro_dis_lpf) ;
00012e  482e              LDR      r0,|L3.488|
000130  6801              LDR      r1,[r0,#0]  ; baro_dis_lpf
000132  4648              MOV      r0,r9
000134  f7fffffe          BL       __aeabi_fsub
000138  4682              MOV      r10,r0
00013a  4930              LDR      r1,|L3.508|
00013c  4620              MOV      r0,r4
00013e  f7fffffe          BL       __aeabi_fmul
000142  4683              MOV      r11,r0
000144  4659              MOV      r1,r11
000146  f04f507e          MOV      r0,#0x3f800000
00014a  f7fffffe          BL       __aeabi_fdiv
00014e  4680              MOV      r8,r0
000150  f04f517e          MOV      r1,#0x3f800000
000154  f7fffffe          BL       __aeabi_fadd
000158  4607              MOV      r7,r0
00015a  4639              MOV      r1,r7
00015c  f04f507e          MOV      r0,#0x3f800000
000160  f7fffffe          BL       __aeabi_fdiv
000164  4606              MOV      r6,r0
000166  4651              MOV      r1,r10
000168  f7fffffe          BL       __aeabi_fmul
00016c  4605              MOV      r5,r0
00016e  481e              LDR      r0,|L3.488|
000170  6801              LDR      r1,[r0,#0]  ; baro_dis_lpf
000172  4628              MOV      r0,r5
000174  f7fffffe          BL       __aeabi_fadd
000178  491b              LDR      r1,|L3.488|
00017a  6008              STR      r0,[r1,#0]  ; baro_dis_lpf
                  |L3.380|
;;;257    			}
;;;258    		}
;;;259    		userdata2[2]=baro_dis_lpf;//调试用
00017c  481a              LDR      r0,|L3.488|
00017e  6800              LDR      r0,[r0,#0]  ; baro_dis_lpf
000180  491f              LDR      r1,|L3.512|
000182  6088              STR      r0,[r1,#8]  ; userdata2
;;;260    		userdata2[3]+= ( 1 / ( 1 + 1 / ( 1.0f *3.14f *T ) ) ) *(Baro_Height_Source- userdata2[3]) ;//调试用	
000184  4608              MOV      r0,r1
000186  68c1              LDR      r1,[r0,#0xc]  ; userdata2
000188  481e              LDR      r0,|L3.516|
00018a  6800              LDR      r0,[r0,#0]  ; Baro_Height_Source
00018c  f7fffffe          BL       __aeabi_fsub
000190  4682              MOV      r10,r0
000192  4919              LDR      r1,|L3.504|
000194  4620              MOV      r0,r4
000196  f7fffffe          BL       __aeabi_fmul
00019a  4683              MOV      r11,r0
00019c  4659              MOV      r1,r11
00019e  f04f507e          MOV      r0,#0x3f800000
0001a2  f7fffffe          BL       __aeabi_fdiv
0001a6  4680              MOV      r8,r0
0001a8  f04f517e          MOV      r1,#0x3f800000
0001ac  f7fffffe          BL       __aeabi_fadd
0001b0  4607              MOV      r7,r0
0001b2  4639              MOV      r1,r7
0001b4  f04f507e          MOV      r0,#0x3f800000
0001b8  f7fffffe          BL       __aeabi_fdiv
0001bc  4605              MOV      r5,r0
0001be  4651              MOV      r1,r10
0001c0  f7fffffe          BL       __aeabi_fmul
0001c4  4606              MOV      r6,r0
0001c6  480e              LDR      r0,|L3.512|
0001c8  68c1              LDR      r1,[r0,#0xc]  ; userdata2
0001ca  4630              MOV      r0,r6
0001cc  f7fffffe          BL       __aeabi_fadd
0001d0  490b              LDR      r1,|L3.512|
0001d2  60c8              STR      r0,[r1,#0xc]  ; userdata2
;;;261    		userdata2[4]=baro_speed;//调试用
0001d4  480c              LDR      r0,|L3.520|
0001d6  6800              LDR      r0,[r0,#0]  ; baro_speed
0001d8  6108              STR      r0,[r1,#0x10]  ; userdata2
;;;262    }
0001da  e8bd9ff0          POP      {r4-r12,pc}
;;;263    
                          ENDP

0001de  0000              DCW      0x0000
                  |L3.480|
                          DCD      baro_height
                  |L3.484|
                          DCD      0x45fa0000
                  |L3.488|
                          DCD      baro_dis_lpf
                  |L3.492|
                          DCD      0x42c80000
                  |L3.496|
                          DCD      0x40c8f5c3
                  |L3.500|
                          DCD      0x43fa0000
                  |L3.504|
                          DCD      0x4048f5c3
                  |L3.508|
                          DCD      0x3fc8f5c3
                  |L3.512|
                          DCD      userdata2
                  |L3.516|
                          DCD      Baro_Height_Source
                  |L3.520|
                          DCD      baro_speed

                          AREA ||i.Height_Ctrl||, CODE, READONLY, ALIGN=2

                  Height_Ctrl PROC
;;;72     
;;;73     void Height_Ctrl(float T,float thr)
000000  e92d5ffc          PUSH     {r2-r12,lr}
;;;74     {	
000004  4683              MOV      r11,r0
000006  468a              MOV      r10,r1
;;;75     	static u8 height_ctrl_start_f;
;;;76     	static float thr_lpf;
;;;77     	static float height_thr;
;;;78     	static float wz_acc_temp,wz_acc1;
;;;79     	static float hc_speed_i,wz_speed_0;
;;;80     	static float h_speed;
;;;81     	
;;;82     	switch( height_ctrl_start_f )
000008  48fe              LDR      r0,|L4.1028|
00000a  7800              LDRB     r0,[r0,#0]  ; height_ctrl_start_f
00000c  b110              CBZ      r0,|L4.20|
00000e  2801              CMP      r0,#1
000010  d17e              BNE      |L4.272|
000012  e009              B        |L4.40|
                  |L4.20|
;;;83     	{
;;;84     		case 0:
;;;85     	
;;;86     				if( sensor.acc.averag.z > 7000 )//注意这里，指水平静态下的Z值要比这个大，表示水平垂直
000014  49fc              LDR      r1,|L4.1032|
000016  6908              LDR      r0,[r1,#0x10]
000018  49fc              LDR      r1,|L4.1036|
00001a  f7fffffe          BL       __aeabi_cfrcmple
00001e  d202              BCS      |L4.38|
;;;87     				{
;;;88     					  height_ctrl_start_f = 1;
000020  2001              MOVS     r0,#1
000022  49f8              LDR      r1,|L4.1028|
000024  7008              STRB     r0,[r1,#0]
                  |L4.38|
;;;89     				}
;;;90     				break;
000026  e277              B        |L4.1304|
                  |L4.40|
;;;91     		
;;;92     		case 1:
;;;93     			
;;;94     				LockForKeepHigh(thr_lpf);//一旦切到控高模式，立即保存当前的距离值，油门值、相关清零。
000028  48f9              LDR      r0,|L4.1040|
00002a  6800              LDR      r0,[r0,#0]  ; thr_lpf
00002c  f7fffffe          BL       LockForKeepHigh
;;;95     				if((flag.FlightMode==ULTRASONIC_High && lock==1 &&lock_spd_crl==0)|| (flag.FlightMode==ATMOSPHERE_High && lock_BARO==1 &&lock_spd_crl==0))
000030  48f8              LDR      r0,|L4.1044|
000032  7cc0              LDRB     r0,[r0,#0x13]  ; flag
000034  2802              CMP      r0,#2
000036  d106              BNE      |L4.70|
000038  48f7              LDR      r0,|L4.1048|
00003a  7800              LDRB     r0,[r0,#0]  ; lock
00003c  2801              CMP      r0,#1
00003e  d102              BNE      |L4.70|
000040  48f6              LDR      r0,|L4.1052|
000042  7800              LDRB     r0,[r0,#0]  ; lock_spd_crl
000044  b150              CBZ      r0,|L4.92|
                  |L4.70|
000046  48f3              LDR      r0,|L4.1044|
000048  7cc0              LDRB     r0,[r0,#0x13]  ; flag
00004a  2803              CMP      r0,#3
00004c  d11f              BNE      |L4.142|
00004e  48f4              LDR      r0,|L4.1056|
000050  7800              LDRB     r0,[r0,#0]  ; lock_BARO
000052  2801              CMP      r0,#1
000054  d11b              BNE      |L4.142|
000056  48f1              LDR      r0,|L4.1052|
000058  7800              LDRB     r0,[r0,#0]  ; lock_spd_crl
00005a  b9c0              CBNZ     r0,|L4.142|
                  |L4.92|
;;;96     				{
;;;97     						keepheight_thr=thr_lpf;
00005c  48ec              LDR      r0,|L4.1040|
00005e  6800              LDR      r0,[r0,#0]  ; thr_lpf
000060  49f0              LDR      r1,|L4.1060|
000062  6008              STR      r0,[r1,#0]  ; keepheight_thr
;;;98     						wz_speed_0=0;
000064  2000              MOVS     r0,#0
000066  49f0              LDR      r1,|L4.1064|
000068  6008              STR      r0,[r1,#0]  ; wz_speed_0
;;;99     						hc_speed_i=0;
00006a  49f0              LDR      r1,|L4.1068|
00006c  6008              STR      r0,[r1,#0]  ; hc_speed_i
;;;100    						hc_speed_i=0;
00006e  6008              STR      r0,[r1,#0]  ; hc_speed_i
;;;101    						wz_speed=0;
000070  49ef              LDR      r1,|L4.1072|
000072  6008              STR      r0,[r1,#0]  ; wz_speed
;;;102    						wz_speed_pid_v.err_old=0;
000074  49ef              LDR      r1,|L4.1076|
000076  6048              STR      r0,[r1,#4]  ; wz_speed_pid_v
;;;103    						wz_speed_pid_v.err=0;
000078  6008              STR      r0,[r1,#0]  ; wz_speed_pid_v
;;;104    						wz_speed_pid_v.err_i=0;
00007a  60c8              STR      r0,[r1,#0xc]  ; wz_speed_pid_v
;;;105    						lock=2;
00007c  2002              MOVS     r0,#2
00007e  49e6              LDR      r1,|L4.1048|
000080  7008              STRB     r0,[r1,#0]
;;;106    						lock_BARO=2;
000082  49e7              LDR      r1,|L4.1056|
000084  7008              STRB     r0,[r1,#0]
;;;107    						lock_spd_crl=1;
000086  2001              MOVS     r0,#1
000088  49e4              LDR      r1,|L4.1052|
00008a  7008              STRB     r0,[r1,#0]
00008c  e00a              B        |L4.164|
                  |L4.142|
;;;108    				}
;;;109    				else if(flag.FlightMode==MANUAL_High)
00008e  48e1              LDR      r0,|L4.1044|
000090  7cc0              LDRB     r0,[r0,#0x13]  ; flag
000092  2801              CMP      r0,#1
000094  d106              BNE      |L4.164|
;;;110    				{
;;;111    						lock=0;
000096  2000              MOVS     r0,#0
000098  49df              LDR      r1,|L4.1048|
00009a  7008              STRB     r0,[r1,#0]
;;;112    						lock_BARO=0;
00009c  49e0              LDR      r1,|L4.1056|
00009e  7008              STRB     r0,[r1,#0]
;;;113    						lock_spd_crl=0;//切回手动模式后置零，以使下次进入定高模式是能顺利置零速度内环	
0000a0  49de              LDR      r1,|L4.1052|
0000a2  7008              STRB     r0,[r1,#0]
                  |L4.164|
;;;114    				}
;;;115    			
;;;116    				height_thr = LIMIT( thr , 0, 700 );
0000a4  2100              MOVS     r1,#0
0000a6  4650              MOV      r0,r10
0000a8  f7fffffe          BL       __aeabi_cfcmple
0000ac  d201              BCS      |L4.178|
0000ae  2000              MOVS     r0,#0
0000b0  e007              B        |L4.194|
                  |L4.178|
0000b2  49e1              LDR      r1,|L4.1080|
0000b4  4650              MOV      r0,r10
0000b6  f7fffffe          BL       __aeabi_cfrcmple
0000ba  d201              BCS      |L4.192|
0000bc  48de              LDR      r0,|L4.1080|
0000be  e000              B        |L4.194|
                  |L4.192|
0000c0  4650              MOV      r0,r10
                  |L4.194|
0000c2  49de              LDR      r1,|L4.1084|
0000c4  6008              STR      r0,[r1,#0]  ; height_thr
;;;117    				thr_lpf += ( 1 / ( 1 + 1 / ( 2.0f *3.14f *T ) ) ) *( height_thr - thr_lpf );//对油门值低通滤波修正
0000c6  48d2              LDR      r0,|L4.1040|
0000c8  6801              LDR      r1,[r0,#0]  ; thr_lpf
0000ca  48dc              LDR      r0,|L4.1084|
0000cc  6800              LDR      r0,[r0,#0]  ; height_thr
0000ce  f7fffffe          BL       __aeabi_fsub
0000d2  4680              MOV      r8,r0
0000d4  49da              LDR      r1,|L4.1088|
0000d6  4658              MOV      r0,r11
0000d8  f7fffffe          BL       __aeabi_fmul
0000dc  4681              MOV      r9,r0
0000de  4649              MOV      r1,r9
0000e0  f04f507e          MOV      r0,#0x3f800000
0000e4  f7fffffe          BL       __aeabi_fdiv
0000e8  4607              MOV      r7,r0
0000ea  f04f517e          MOV      r1,#0x3f800000
0000ee  f7fffffe          BL       __aeabi_fadd
0000f2  4606              MOV      r6,r0
0000f4  4631              MOV      r1,r6
0000f6  f04f507e          MOV      r0,#0x3f800000
0000fa  f7fffffe          BL       __aeabi_fdiv
0000fe  4605              MOV      r5,r0
000100  4641              MOV      r1,r8
000102  f7fffffe          BL       __aeabi_fmul
000106  4604              MOV      r4,r0
000108  48c1              LDR      r0,|L4.1040|
00010a  6801              LDR      r1,[r0,#0]  ; thr_lpf
00010c  4620              MOV      r0,r4
00010e  e000              B        |L4.274|
                  |L4.272|
000110  e201              B        |L4.1302|
                  |L4.274|
000112  f7fffffe          BL       __aeabi_fadd
000116  49be              LDR      r1,|L4.1040|
000118  6008              STR      r0,[r1,#0]  ; thr_lpf
;;;118    				userdata1[0]=	thr_lpf;//调试用
00011a  4608              MOV      r0,r1
00011c  6800              LDR      r0,[r0,#0]  ; thr_lpf
00011e  49c9              LDR      r1,|L4.1092|
000120  6008              STR      r0,[r1,#0]  ; userdata1
;;;119    				/*下面的低通滤波用于测试对比效果，最终没有选用*/				
;;;120    		    //wz_acc += ( 1 / ( 1 + 1 / ( 8 *3.14f *T ) ) ) *my_deathzoom( (V.z *(sensor.acc.averag.z- sensor.acc.quiet.z) + V.x *sensor.acc.averag.x + V.y *sensor.acc.averag.y - wz_acc),100 );//
;;;121    		    //wz_acc_mms2 = (float)(wz_acc/8192.0f) *9800 ;
;;;122    				//加速度的静态零点是读取的EEPROM数据，但是每次飞行都可能不一样，能每次起飞前校准一次最好，可以单独校准Z轴的，自行设计程序
;;;123    				wz_acc_temp = V.z *(sensor.acc.averag.z- sensor.acc.quiet.z) + V.x *sensor.acc.averag.x + V.y *sensor.acc.averag.y;//
000122  4ab9              LDR      r2,|L4.1032|
000124  68d1              LDR      r1,[r2,#0xc]
000126  4ac8              LDR      r2,|L4.1096|
000128  6850              LDR      r0,[r2,#4]  ; V
00012a  f7fffffe          BL       __aeabi_fmul
00012e  4607              MOV      r7,r0
000130  4ab5              LDR      r2,|L4.1032|
000132  6891              LDR      r1,[r2,#8]  ; sensor
000134  4ac4              LDR      r2,|L4.1096|
000136  6810              LDR      r0,[r2,#0]  ; V
000138  f7fffffe          BL       __aeabi_fmul
00013c  4680              MOV      r8,r0
00013e  49b2              LDR      r1,|L4.1032|
000140  f9b10024          LDRSH    r0,[r1,#0x24]
000144  f7fffffe          BL       __aeabi_i2f
000148  4681              MOV      r9,r0
00014a  48af              LDR      r0,|L4.1032|
00014c  6901              LDR      r1,[r0,#0x10]
00014e  4648              MOV      r0,r9
000150  f7fffffe          BL       __aeabi_frsub
000154  4604              MOV      r4,r0
000156  48bc              LDR      r0,|L4.1096|
000158  6881              LDR      r1,[r0,#8]  ; V
00015a  4620              MOV      r0,r4
00015c  f7fffffe          BL       __aeabi_fmul
000160  4606              MOV      r6,r0
000162  4641              MOV      r1,r8
000164  f7fffffe          BL       __aeabi_fadd
000168  4605              MOV      r5,r0
00016a  4639              MOV      r1,r7
00016c  f7fffffe          BL       __aeabi_fadd
000170  49b6              LDR      r1,|L4.1100|
000172  6008              STR      r0,[r1,#0]  ; wz_acc_temp
;;;124    				Moving_Average( wz_acc_temp,acc_speed_arr,ACC_SPEED_NUM,acc_cnt ,&wz_acc1 );
000174  48b6              LDR      r0,|L4.1104|
000176  4bb7              LDR      r3,|L4.1108|
000178  2232              MOVS     r2,#0x32
00017a  49b7              LDR      r1,|L4.1112|
00017c  9000              STR      r0,[sp,#0]
00017e  48b3              LDR      r0,|L4.1100|
000180  6800              LDR      r0,[r0,#0]  ; wz_acc_temp
000182  f7fffffe          BL       Moving_Average
;;;125    				tempacc_lpf= (float)(wz_acc1/8192.0f) *9800;//9800 *T;由于是+-4G共8G，65535/8g=8192 g，加速度，mms2毫米每平方秒
000186  f04f418c          MOV      r1,#0x46000000
00018a  48b1              LDR      r0,|L4.1104|
00018c  6800              LDR      r0,[r0,#0]  ; wz_acc1
00018e  f7fffffe          BL       __aeabi_fdiv
000192  4604              MOV      r4,r0
000194  49b1              LDR      r1,|L4.1116|
000196  f7fffffe          BL       __aeabi_fmul
00019a  49b1              LDR      r1,|L4.1120|
00019c  6008              STR      r0,[r1,#0]  ; tempacc_lpf
;;;126    				if(abs(tempacc_lpf)<50)tempacc_lpf=0;//简单消除下噪声
00019e  4608              MOV      r0,r1
0001a0  6800              LDR      r0,[r0,#0]  ; tempacc_lpf
0001a2  f7fffffe          BL       __aeabi_f2iz
0001a6  1e04              SUBS     r4,r0,#0
0001a8  db01              BLT      |L4.430|
0001aa  4620              MOV      r0,r4
0001ac  e000              B        |L4.432|
                  |L4.430|
0001ae  4260              RSBS     r0,r4,#0
                  |L4.432|
0001b0  2832              CMP      r0,#0x32
0001b2  da02              BGE      |L4.442|
0001b4  2000              MOVS     r0,#0
0001b6  49aa              LDR      r1,|L4.1120|
0001b8  6008              STR      r0,[r1,#0]  ; tempacc_lpf
                  |L4.442|
;;;127    				userdata1[2]=tempacc_lpf;
0001ba  48a9              LDR      r0,|L4.1120|
0001bc  6800              LDR      r0,[r0,#0]  ; tempacc_lpf
0001be  49a1              LDR      r1,|L4.1092|
0001c0  6088              STR      r0,[r1,#8]  ; userdata1
;;;128    				wz_speed_0 += tempacc_lpf *T;//加速度计积分成速度
0001c2  48a7              LDR      r0,|L4.1120|
0001c4  6801              LDR      r1,[r0,#0]  ; tempacc_lpf
0001c6  4658              MOV      r0,r11
0001c8  f7fffffe          BL       __aeabi_fmul
0001cc  4604              MOV      r4,r0
0001ce  4896              LDR      r0,|L4.1064|
0001d0  6801              LDR      r1,[r0,#0]  ; wz_speed_0
0001d2  4620              MOV      r0,r4
0001d4  f7fffffe          BL       __aeabi_fadd
0001d8  4993              LDR      r1,|L4.1064|
0001da  6008              STR      r0,[r1,#0]  ; wz_speed_0
;;;129    								
;;;130    				if( ultra_start_f == 1 )////不管是啥模式，只要更新了超声波数据就进行运算
0001dc  48a1              LDR      r0,|L4.1124|
0001de  7800              LDRB     r0,[r0,#0]  ; ultra_start_f
0001e0  2801              CMP      r0,#1
0001e2  d105              BNE      |L4.496|
;;;131    				{	
;;;132    					 Ultra_dataporcess(15.0f*TT);
0001e4  48a0              LDR      r0,|L4.1128|
0001e6  f7fffffe          BL       Ultra_dataporcess
;;;133    					 ultra_start_f=2;
0001ea  2002              MOVS     r0,#2
0001ec  499d              LDR      r1,|L4.1124|
0001ee  7008              STRB     r0,[r1,#0]
                  |L4.496|
;;;134    				}
;;;135    				
;;;136    				if(baro_start_f==1)//不管是啥模式，只要更新了气压数据就进行运算
0001f0  489e              LDR      r0,|L4.1132|
0001f2  7800              LDRB     r0,[r0,#0]  ; baro_start_f
0001f4  2801              CMP      r0,#1
0001f6  d12a              BNE      |L4.590|
;;;137    				{ 
;;;138    					 Baro_dataporcess(8.0f*TT);			 //8.0f*TT这么长时间更新一次气压计数据
0001f8  489d              LDR      r0,|L4.1136|
0001fa  f7fffffe          BL       Baro_dataporcess
;;;139    					 userdata2[10]=baro_height;//Baro_Height_Source
0001fe  489d              LDR      r0,|L4.1140|
000200  6800              LDR      r0,[r0,#0]  ; baro_height
000202  499d              LDR      r1,|L4.1144|
000204  6288              STR      r0,[r1,#0x28]  ; userdata2
;;;140    					 baro_dis_delta=baro_height-baro_dis_old;
000206  489d              LDR      r0,|L4.1148|
000208  6801              LDR      r1,[r0,#0]  ; baro_dis_old
00020a  489a              LDR      r0,|L4.1140|
00020c  6800              LDR      r0,[r0,#0]  ; baro_height
00020e  f7fffffe          BL       __aeabi_fsub
000212  499b              LDR      r1,|L4.1152|
000214  6008              STR      r0,[r1,#0]  ; baro_dis_delta
;;;141    					 baro_dis_old=baro_height;//气压计速度可以继续优化，这里比较粗糙			 
000216  4897              LDR      r0,|L4.1140|
000218  6800              LDR      r0,[r0,#0]  ; baro_height
00021a  4998              LDR      r1,|L4.1148|
00021c  6008              STR      r0,[r1,#0]  ; baro_dis_old
;;;142    		       //Moving_Average( (float)( baro_dis_delta/(8.0f*TT)),baro_speed_arr,BARO_SPEED_NUM,baro_cnt ,&baro_speed ); //单位mm/s
;;;143    					 userdata1[11]=baro_speed_lpf=0.4* baro_dis_delta/(8.0f*TT);//baro_speed这里乘以系数以削减该值		 
00021e  4898              LDR      r0,|L4.1152|
000220  6800              LDR      r0,[r0,#0]  ; baro_dis_delta
000222  f7fffffe          BL       __aeabi_f2d
000226  4680              MOV      r8,r0
000228  4a96              LDR      r2,|L4.1156|
00022a  4b97              LDR      r3,|L4.1160|
00022c  f7fffffe          BL       __aeabi_dmul
000230  4606              MOV      r6,r0
000232  4a96              LDR      r2,|L4.1164|
000234  4b96              LDR      r3,|L4.1168|
000236  f7fffffe          BL       __aeabi_ddiv
00023a  4604              MOV      r4,r0
00023c  f7fffffe          BL       __aeabi_d2f
000240  4994              LDR      r1,|L4.1172|
000242  6008              STR      r0,[r1,#0]  ; baro_speed_lpf
000244  497f              LDR      r1,|L4.1092|
000246  62c8              STR      r0,[r1,#0x2c]  ; userdata1
;;;144    					 baro_start_f=2;
000248  2002              MOVS     r0,#2
00024a  4988              LDR      r1,|L4.1132|
00024c  7008              STRB     r0,[r1,#0]
                  |L4.590|
;;;145    				}	
;;;146    		
;;;147    				if(flag.FlightMode==ULTRASONIC_High)
00024e  4871              LDR      r0,|L4.1044|
000250  7cc0              LDRB     r0,[r0,#0x13]  ; flag
000252  2802              CMP      r0,#2
000254  d123              BNE      |L4.670|
;;;148    				{
;;;149    					 h_speed=ultra_speed;
000256  4890              LDR      r0,|L4.1176|
000258  6800              LDR      r0,[r0,#0]  ; ultra_speed
00025a  4990              LDR      r1,|L4.1180|
00025c  6008              STR      r0,[r1,#0]  ; h_speed
;;;150    					 wz_speed_0 = 0.99	*wz_speed_0 + 0.01*h_speed;//超声波垂直速度互补滤波
00025e  4608              MOV      r0,r1
000260  6800              LDR      r0,[r0,#0]  ; h_speed
000262  f7fffffe          BL       __aeabi_f2d
000266  4606              MOV      r6,r0
000268  4a88              LDR      r2,|L4.1164|
00026a  4b8d              LDR      r3,|L4.1184|
00026c  f7fffffe          BL       __aeabi_dmul
000270  4604              MOV      r4,r0
000272  460d              MOV      r5,r1
000274  486c              LDR      r0,|L4.1064|
000276  6800              LDR      r0,[r0,#0]  ; wz_speed_0
000278  f7fffffe          BL       __aeabi_f2d
00027c  4606              MOV      r6,r0
00027e  4a89              LDR      r2,|L4.1188|
000280  4b89              LDR      r3,|L4.1192|
000282  f7fffffe          BL       __aeabi_dmul
000286  4680              MOV      r8,r0
000288  4622              MOV      r2,r4
00028a  462b              MOV      r3,r5
00028c  f7fffffe          BL       __aeabi_dadd
000290  e9cd0100          STRD     r0,r1,[sp,#0]
000294  f7fffffe          BL       __aeabi_d2f
000298  4963              LDR      r1,|L4.1064|
00029a  6008              STR      r0,[r1,#0]  ; wz_speed_0
00029c  e026              B        |L4.748|
                  |L4.670|
;;;151    				}				
;;;152    				else if(flag.FlightMode==ATMOSPHERE_High)
00029e  485d              LDR      r0,|L4.1044|
0002a0  7cc0              LDRB     r0,[r0,#0x13]  ; flag
0002a2  2803              CMP      r0,#3
0002a4  d122              BNE      |L4.748|
;;;153    				{
;;;154    					 h_speed=baro_speed_lpf;
0002a6  487b              LDR      r0,|L4.1172|
0002a8  6800              LDR      r0,[r0,#0]  ; baro_speed_lpf
0002aa  497c              LDR      r1,|L4.1180|
0002ac  6008              STR      r0,[r1,#0]  ; h_speed
;;;155    					 wz_speed_0 = 0.99	*wz_speed_0 + 0.01*h_speed;//气压计垂直速度互补滤波，系数可调
0002ae  4608              MOV      r0,r1
0002b0  6800              LDR      r0,[r0,#0]  ; h_speed
0002b2  f7fffffe          BL       __aeabi_f2d
0002b6  4606              MOV      r6,r0
0002b8  4a74              LDR      r2,|L4.1164|
0002ba  4b79              LDR      r3,|L4.1184|
0002bc  f7fffffe          BL       __aeabi_dmul
0002c0  4680              MOV      r8,r0
0002c2  4689              MOV      r9,r1
0002c4  4858              LDR      r0,|L4.1064|
0002c6  6800              LDR      r0,[r0,#0]  ; wz_speed_0
0002c8  f7fffffe          BL       __aeabi_f2d
0002cc  4606              MOV      r6,r0
0002ce  4a75              LDR      r2,|L4.1188|
0002d0  4b75              LDR      r3,|L4.1192|
0002d2  f7fffffe          BL       __aeabi_dmul
0002d6  4642              MOV      r2,r8
0002d8  464b              MOV      r3,r9
0002da  e9cd0100          STRD     r0,r1,[sp,#0]
0002de  f7fffffe          BL       __aeabi_dadd
0002e2  4604              MOV      r4,r0
0002e4  f7fffffe          BL       __aeabi_d2f
0002e8  494f              LDR      r1,|L4.1064|
0002ea  6008              STR      r0,[r1,#0]  ; wz_speed_0
                  |L4.748|
;;;156    				}	
;;;157    
;;;158    				userdata1[3] =h_speed;//h_speed是高度环传到速度环的实测高度方向速度【但可能是错误的，气压计速度不可靠】
0002ec  486b              LDR      r0,|L4.1180|
0002ee  6800              LDR      r0,[r0,#0]  ; h_speed
0002f0  4954              LDR      r1,|L4.1092|
0002f2  60c8              STR      r0,[r1,#0xc]  ; userdata1
;;;159    				userdata1[4]=wz_speed_0;//调试用
0002f4  484c              LDR      r0,|L4.1064|
0002f6  6800              LDR      r0,[r0,#0]  ; wz_speed_0
0002f8  6108              STR      r0,[r1,#0x10]  ; userdata1
;;;160    				hc_speed_i += 0.4f *T *( h_speed - wz_speed );//速度偏差积分，乘以了0.4系数
0002fa  484d              LDR      r0,|L4.1072|
0002fc  6801              LDR      r1,[r0,#0]  ; wz_speed
0002fe  4867              LDR      r0,|L4.1180|
000300  6800              LDR      r0,[r0,#0]  ; h_speed
000302  f7fffffe          BL       __aeabi_fsub
000306  4605              MOV      r5,r0
000308  4968              LDR      r1,|L4.1196|
00030a  4658              MOV      r0,r11
00030c  f7fffffe          BL       __aeabi_fmul
000310  4606              MOV      r6,r0
000312  4629              MOV      r1,r5
000314  f7fffffe          BL       __aeabi_fmul
000318  4604              MOV      r4,r0
00031a  4844              LDR      r0,|L4.1068|
00031c  6801              LDR      r1,[r0,#0]  ; hc_speed_i
00031e  4620              MOV      r0,r4
000320  f7fffffe          BL       __aeabi_fadd
000324  4941              LDR      r1,|L4.1068|
000326  6008              STR      r0,[r1,#0]  ; hc_speed_i
;;;161    				hc_speed_i = LIMIT( hc_speed_i, -500, 500 );//积分限幅	
000328  4961              LDR      r1,|L4.1200|
00032a  4840              LDR      r0,|L4.1068|
00032c  6800              LDR      r0,[r0,#0]  ; hc_speed_i
00032e  f7fffffe          BL       __aeabi_cfcmple
000332  d201              BCS      |L4.824|
000334  485e              LDR      r0,|L4.1200|
000336  e009              B        |L4.844|
                  |L4.824|
000338  495e              LDR      r1,|L4.1204|
00033a  483c              LDR      r0,|L4.1068|
00033c  6800              LDR      r0,[r0,#0]  ; hc_speed_i
00033e  f7fffffe          BL       __aeabi_cfrcmple
000342  d201              BCS      |L4.840|
000344  485b              LDR      r0,|L4.1204|
000346  e001              B        |L4.844|
                  |L4.840|
000348  4838              LDR      r0,|L4.1068|
00034a  6800              LDR      r0,[r0,#0]  ; hc_speed_i
                  |L4.844|
00034c  4937              LDR      r1,|L4.1068|
00034e  6008              STR      r0,[r1,#0]  ; hc_speed_i
;;;162    				userdata1[5] =hc_speed_i;//这个没显示
000350  4608              MOV      r0,r1
000352  6800              LDR      r0,[r0,#0]  ; hc_speed_i
000354  493b              LDR      r1,|L4.1092|
000356  6148              STR      r0,[r1,#0x14]  ; userdata1
;;;163    				wz_speed_0 += ( 1 / ( 1 + 1 / ( 0.1f *3.14f *T ) ) ) *( h_speed - wz_speed_0  ) ;//0.1实测速度修正加速度算的速度
000358  4833              LDR      r0,|L4.1064|
00035a  6801              LDR      r1,[r0,#0]  ; wz_speed_0
00035c  484f              LDR      r0,|L4.1180|
00035e  6800              LDR      r0,[r0,#0]  ; h_speed
000360  f7fffffe          BL       __aeabi_fsub
000364  4680              MOV      r8,r0
000366  4954              LDR      r1,|L4.1208|
000368  4658              MOV      r0,r11
00036a  f7fffffe          BL       __aeabi_fmul
00036e  4681              MOV      r9,r0
000370  4649              MOV      r1,r9
000372  f04f507e          MOV      r0,#0x3f800000
000376  f7fffffe          BL       __aeabi_fdiv
00037a  4607              MOV      r7,r0
00037c  f04f517e          MOV      r1,#0x3f800000
000380  f7fffffe          BL       __aeabi_fadd
000384  4606              MOV      r6,r0
000386  4631              MOV      r1,r6
000388  f04f507e          MOV      r0,#0x3f800000
00038c  f7fffffe          BL       __aeabi_fdiv
000390  4605              MOV      r5,r0
000392  4641              MOV      r1,r8
000394  f7fffffe          BL       __aeabi_fmul
000398  4604              MOV      r4,r0
00039a  4823              LDR      r0,|L4.1064|
00039c  6801              LDR      r1,[r0,#0]  ; wz_speed_0
00039e  4620              MOV      r0,r4
0003a0  f7fffffe          BL       __aeabi_fadd
0003a4  4920              LDR      r1,|L4.1064|
0003a6  6008              STR      r0,[r1,#0]  ; wz_speed_0
;;;164    				userdata1[6] = wz_speed=wz_speed_0 + hc_speed_i;//经过修正的速度+经过限幅的增量式速度积分
0003a8  4820              LDR      r0,|L4.1068|
0003aa  6801              LDR      r1,[r0,#0]  ; hc_speed_i
0003ac  481e              LDR      r0,|L4.1064|
0003ae  6800              LDR      r0,[r0,#0]  ; wz_speed_0
0003b0  f7fffffe          BL       __aeabi_fadd
0003b4  491e              LDR      r1,|L4.1072|
0003b6  6008              STR      r0,[r1,#0]  ; wz_speed
0003b8  4922              LDR      r1,|L4.1092|
0003ba  6188              STR      r0,[r1,#0x18]  ; userdata1
;;;165    
;;;166    			  if( flag.FlightMode == ATMOSPHERE_High)
0003bc  4815              LDR      r0,|L4.1044|
0003be  7cc0              LDRB     r0,[r0,#0x13]  ; flag
0003c0  2803              CMP      r0,#3
0003c2  d114              BNE      |L4.1006|
;;;167    				{
;;;168    						if(baro_start_f==2)//说明有新数据且被上面移动均值滤波使用过了
0003c4  4829              LDR      r0,|L4.1132|
0003c6  7800              LDRB     r0,[r0,#0]  ; baro_start_f
0003c8  2802              CMP      r0,#2
0003ca  d107              BNE      |L4.988|
;;;169    						{
;;;170    							baro_start_f = -1;
0003cc  20ff              MOVS     r0,#0xff
0003ce  4927              LDR      r1,|L4.1132|
0003d0  7008              STRB     r0,[r1,#0]
;;;171    							Baro_Ctrl(8.0f*TT,thr_lpf);
0003d2  480f              LDR      r0,|L4.1040|
0003d4  6801              LDR      r1,[r0,#0]  ; thr_lpf
0003d6  4826              LDR      r0,|L4.1136|
0003d8  f7fffffe          BL       Baro_Ctrl
                  |L4.988|
;;;172    						}	
;;;173    						height_speed_ctrl(T,keepheight_thr,baro_ctrl_out,baro_speed_lpf);							
0003dc  482d              LDR      r0,|L4.1172|
0003de  6803              LDR      r3,[r0,#0]  ; baro_speed_lpf
0003e0  4836              LDR      r0,|L4.1212|
0003e2  6802              LDR      r2,[r0,#0]  ; baro_ctrl_out
0003e4  480f              LDR      r0,|L4.1060|
0003e6  6801              LDR      r1,[r0,#0]  ; keepheight_thr
0003e8  4658              MOV      r0,r11
0003ea  f7fffffe          BL       height_speed_ctrl
                  |L4.1006|
;;;174    				}
;;;175    
;;;176    				if( flag.FlightMode == ULTRASONIC_High)
0003ee  4809              LDR      r0,|L4.1044|
0003f0  7cc0              LDRB     r0,[r0,#0x13]  ; flag
0003f2  2802              CMP      r0,#2
0003f4  d176              BNE      |L4.1252|
;;;177    				{
;;;178    						height_speed_ctrl(T,keepheight_thr,ultra_ctrl_out,ultra_speed);//系数原来是0.4
0003f6  4828              LDR      r0,|L4.1176|
0003f8  6803              LDR      r3,[r0,#0]  ; ultra_speed
0003fa  4831              LDR      r0,|L4.1216|
0003fc  6802              LDR      r2,[r0,#0]  ; ultra_ctrl_out
0003fe  4809              LDR      r0,|L4.1060|
000400  6801              LDR      r1,[r0,#0]  ; keepheight_thr
000402  e060              B        |L4.1222|
                  |L4.1028|
                          DCD      height_ctrl_start_f
                  |L4.1032|
                          DCD      sensor
                  |L4.1036|
                          DCD      0x45dac000
                  |L4.1040|
                          DCD      thr_lpf
                  |L4.1044|
                          DCD      flag
                  |L4.1048|
                          DCD      lock
                  |L4.1052|
                          DCD      lock_spd_crl
                  |L4.1056|
                          DCD      lock_BARO
                  |L4.1060|
                          DCD      keepheight_thr
                  |L4.1064|
                          DCD      wz_speed_0
                  |L4.1068|
                          DCD      hc_speed_i
                  |L4.1072|
                          DCD      wz_speed
                  |L4.1076|
                          DCD      wz_speed_pid_v
                  |L4.1080|
                          DCD      0x442f0000
                  |L4.1084|
                          DCD      height_thr
                  |L4.1088|
                          DCD      0x40c8f5c3
                  |L4.1092|
                          DCD      userdata1
                  |L4.1096|
                          DCD      V
                  |L4.1100|
                          DCD      wz_acc_temp
                  |L4.1104|
                          DCD      wz_acc1
                  |L4.1108|
                          DCD      acc_cnt
                  |L4.1112|
                          DCD      acc_speed_arr
                  |L4.1116|
                          DCD      0x46192000
                  |L4.1120|
                          DCD      tempacc_lpf
                  |L4.1124|
                          DCD      ultra_start_f
                  |L4.1128|
                          DCD      0x3d19999a
                  |L4.1132|
                          DCD      baro_start_f
                  |L4.1136|
                          DCD      0x3ca3d70a
                  |L4.1140|
                          DCD      baro_height
                  |L4.1144|
                          DCD      userdata2
                  |L4.1148|
                          DCD      baro_dis_old
                  |L4.1152|
                          DCD      baro_dis_delta
                  |L4.1156|
                          DCD      0x9999999a
                  |L4.1160|
                          DCD      0x3fd99999
                  |L4.1164|
                          DCD      0x47ae147b
                  |L4.1168|
                          DCD      0x3f947ae1
                  |L4.1172|
                          DCD      baro_speed_lpf
                  |L4.1176|
                          DCD      ultra_speed
                  |L4.1180|
                          DCD      h_speed
                  |L4.1184|
                          DCD      0x3f847ae1
                  |L4.1188|
                          DCD      0x7ae147ae
                  |L4.1192|
                          DCD      0x3fefae14
                  |L4.1196|
                          DCD      0x3ecccccd
                  |L4.1200|
                          DCD      0xc3fa0000
                  |L4.1204|
                          DCD      0x43fa0000
                  |L4.1208|
                          DCD      0x3ea0c49c
                  |L4.1212|
                          DCD      baro_ctrl_out
                  |L4.1216|
                          DCD      ultra_ctrl_out
0004c4  e00e              B        |L4.1252|
                  |L4.1222|
0004c6  4658              MOV      r0,r11
0004c8  f7fffffe          BL       height_speed_ctrl
;;;179    							
;;;180    						if( ultra_start_f == 2 )//超声波数据更新了且被运算了
0004cc  4814              LDR      r0,|L4.1312|
0004ce  7800              LDRB     r0,[r0,#0]  ; ultra_start_f
0004d0  2802              CMP      r0,#2
0004d2  d107              BNE      |L4.1252|
;;;181    						{				
;;;182    								Ultra_Ctrl(15.0f*TT,thr_lpf);//realtime是周期为 TT 秒的，#define TT 0.0025//控制周期2.5ms
0004d4  4813              LDR      r0,|L4.1316|
0004d6  6801              LDR      r1,[r0,#0]  ; thr_lpf
0004d8  4813              LDR      r0,|L4.1320|
0004da  f7fffffe          BL       Ultra_Ctrl
;;;183    								ultra_start_f = -1;
0004de  20ff              MOVS     r0,#0xff
0004e0  490f              LDR      r1,|L4.1312|
0004e2  7008              STRB     r0,[r1,#0]
                  |L4.1252|
;;;184    						}
;;;185    				}
;;;186    		
;;;187    	      /*******************************************控制高度输出********************************************/
;;;188    				if(flag.FlightMode==ULTRASONIC_High || flag.FlightMode==ATMOSPHERE_High || flag.FlightMode==ACC_High)//注意这里，模式
0004e4  4811              LDR      r0,|L4.1324|
0004e6  7cc0              LDRB     r0,[r0,#0x13]  ; flag
0004e8  2802              CMP      r0,#2
0004ea  d007              BEQ      |L4.1276|
0004ec  480f              LDR      r0,|L4.1324|
0004ee  7cc0              LDRB     r0,[r0,#0x13]  ; flag
0004f0  2803              CMP      r0,#3
0004f2  d003              BEQ      |L4.1276|
0004f4  480d              LDR      r0,|L4.1324|
0004f6  7cc0              LDRB     r0,[r0,#0x13]  ; flag
0004f8  2806              CMP      r0,#6
0004fa  d104              BNE      |L4.1286|
                  |L4.1276|
;;;189    				{		
;;;190    					  height_ctrl_out = wz_speed_pid_v.pid_out;
0004fc  480c              LDR      r0,|L4.1328|
0004fe  6900              LDR      r0,[r0,#0x10]  ; wz_speed_pid_v
000500  490c              LDR      r1,|L4.1332|
000502  6008              STR      r0,[r1,#0]  ; height_ctrl_out
000504  e002              B        |L4.1292|
                  |L4.1286|
;;;191    				}
;;;192    				else
;;;193    				{
;;;194    					  height_ctrl_out = thr;
000506  480b              LDR      r0,|L4.1332|
000508  f8c0a000          STR      r10,[r0,#0]  ; height_ctrl_out
                  |L4.1292|
;;;195    				}
;;;196    				userdata2[0]=exp_height;
00050c  480a              LDR      r0,|L4.1336|
00050e  6800              LDR      r0,[r0,#0]  ; exp_height
000510  490a              LDR      r1,|L4.1340|
000512  6008              STR      r0,[r1,#0]  ; userdata2
;;;197    			
;;;198    				break; 	
000514  e000              B        |L4.1304|
                  |L4.1302|
;;;199    				default: break;
000516  bf00              NOP      
                  |L4.1304|
000518  bf00              NOP                            ;90
;;;200    	} 
;;;201    }
00051a  e8bd9ffc          POP      {r2-r12,pc}
;;;202    
                          ENDP

00051e  0000              DCW      0x0000
                  |L4.1312|
                          DCD      ultra_start_f
                  |L4.1316|
                          DCD      thr_lpf
                  |L4.1320|
                          DCD      0x3d19999a
                  |L4.1324|
                          DCD      flag
                  |L4.1328|
                          DCD      wz_speed_pid_v
                  |L4.1332|
                          DCD      height_ctrl_out
                  |L4.1336|
                          DCD      exp_height
                  |L4.1340|
                          DCD      userdata2

                          AREA ||i.LockForKeepHigh||, CODE, READONLY, ALIGN=2

                  LockForKeepHigh PROC
;;;384    
;;;385    void LockForKeepHigh(float THROTTLE)
000000  492e              LDR      r1,|L5.188|
;;;386    {
;;;387        if (flag.FlightMode==ULTRASONIC_High && lock==0)
000002  7cc9              LDRB     r1,[r1,#0x13]  ; flag
000004  2902              CMP      r1,#2
000006  d11e              BNE      |L5.70|
000008  492d              LDR      r1,|L5.192|
00000a  7809              LDRB     r1,[r1,#0]  ; lock
00000c  b9d9              CBNZ     r1,|L5.70|
;;;388    		{
;;;389    			  wz_speed_pid.kp=ultra_wz_speed_pid.kp;//变PID
00000e  492d              LDR      r1,|L5.196|
000010  6809              LDR      r1,[r1,#0]  ; ultra_wz_speed_pid
000012  4a2d              LDR      r2,|L5.200|
000014  6011              STR      r1,[r2,#0]  ; wz_speed_pid
;;;390    		    wz_speed_pid.ki=ultra_wz_speed_pid.ki;
000016  492b              LDR      r1,|L5.196|
000018  6889              LDR      r1,[r1,#8]  ; ultra_wz_speed_pid
00001a  6091              STR      r1,[r2,#8]  ; wz_speed_pid
;;;391    		    wz_speed_pid.kd=ultra_wz_speed_pid.kd;
00001c  4929              LDR      r1,|L5.196|
00001e  6849              LDR      r1,[r1,#4]  ; ultra_wz_speed_pid
000020  6051              STR      r1,[r2,#4]  ; wz_speed_pid
;;;392            exp_height=ultra_dis_lpf;//这个超声波高度值经过滤波处理
000022  492a              LDR      r1,|L5.204|
000024  6809              LDR      r1,[r1,#0]  ; ultra_dis_lpf
000026  4a2a              LDR      r2,|L5.208|
000028  6011              STR      r1,[r2,#0]  ; exp_height
;;;393    			  wz_acc=0;
00002a  2100              MOVS     r1,#0
00002c  4a29              LDR      r2,|L5.212|
00002e  6011              STR      r1,[r2,#0]  ; wz_acc
;;;394    			  wz_speed_pid_v.err_i=0;
000030  4a29              LDR      r2,|L5.216|
000032  60d1              STR      r1,[r2,#0xc]  ; wz_speed_pid_v
;;;395    				ultra_speed=0;//若不清零，则且超声波时原来累积的速度会错误传递给当前，造成掉高
000034  4a29              LDR      r2,|L5.220|
000036  6011              STR      r1,[r2,#0]  ; ultra_speed
;;;396    			  ultra_ctrl.err_i=0;
000038  4a29              LDR      r2,|L5.224|
00003a  60d1              STR      r1,[r2,#0xc]  ; ultra_ctrl
;;;397    				ultra_ctrl.err_old=0;
00003c  6051              STR      r1,[r2,#4]  ; ultra_ctrl
;;;398    			  lock=1;
00003e  2101              MOVS     r1,#1
000040  4a1f              LDR      r2,|L5.192|
000042  7011              STRB     r1,[r2,#0]
000044  e00a              B        |L5.92|
                  |L5.70|
;;;399        }
;;;400    		else if(flag.FlightMode==MANUAL_High || flag.FlightMode==ATMOSPHERE_High)
000046  491d              LDR      r1,|L5.188|
000048  7cc9              LDRB     r1,[r1,#0x13]  ; flag
00004a  2901              CMP      r1,#1
00004c  d003              BEQ      |L5.86|
00004e  491b              LDR      r1,|L5.188|
000050  7cc9              LDRB     r1,[r1,#0x13]  ; flag
000052  2903              CMP      r1,#3
000054  d102              BNE      |L5.92|
                  |L5.86|
;;;401    		{lock=0;}
000056  2100              MOVS     r1,#0
000058  4a19              LDR      r2,|L5.192|
00005a  7011              STRB     r1,[r2,#0]
                  |L5.92|
;;;402    						
;;;403    		if (flag.FlightMode==ATMOSPHERE_High && lock_BARO==0)
00005c  4917              LDR      r1,|L5.188|
00005e  7cc9              LDRB     r1,[r1,#0x13]  ; flag
000060  2903              CMP      r1,#3
000062  d11e              BNE      |L5.162|
000064  491f              LDR      r1,|L5.228|
000066  7809              LDRB     r1,[r1,#0]  ; lock_BARO
000068  b9d9              CBNZ     r1,|L5.162|
;;;404    		{
;;;405    			  wz_speed_pid.kp=baro_wz_speed_pid.kp;//变PID
00006a  491f              LDR      r1,|L5.232|
00006c  6809              LDR      r1,[r1,#0]  ; baro_wz_speed_pid
00006e  4a16              LDR      r2,|L5.200|
000070  6011              STR      r1,[r2,#0]  ; wz_speed_pid
;;;406    		    wz_speed_pid.ki=baro_wz_speed_pid.ki;
000072  491d              LDR      r1,|L5.232|
000074  6889              LDR      r1,[r1,#8]  ; baro_wz_speed_pid
000076  6091              STR      r1,[r2,#8]  ; wz_speed_pid
;;;407    		    wz_speed_pid.kd=baro_wz_speed_pid.kd;
000078  491b              LDR      r1,|L5.232|
00007a  6849              LDR      r1,[r1,#4]  ; baro_wz_speed_pid
00007c  6051              STR      r1,[r2,#4]  ; wz_speed_pid
;;;408            exp_height=baro_dis_lpf;
00007e  491b              LDR      r1,|L5.236|
000080  6809              LDR      r1,[r1,#0]  ; baro_dis_lpf
000082  4a13              LDR      r2,|L5.208|
000084  6011              STR      r1,[r2,#0]  ; exp_height
;;;409    			  wz_acc=0;
000086  2100              MOVS     r1,#0
000088  4a12              LDR      r2,|L5.212|
00008a  6011              STR      r1,[r2,#0]  ; wz_acc
;;;410    				baro_speed=0;
00008c  4a18              LDR      r2,|L5.240|
00008e  6011              STR      r1,[r2,#0]  ; baro_speed
;;;411    				baro_speed_lpf=0;
000090  4a18              LDR      r2,|L5.244|
000092  6011              STR      r1,[r2,#0]  ; baro_speed_lpf
;;;412    			  baro_ctrl.err_i=0;
000094  4a18              LDR      r2,|L5.248|
000096  60d1              STR      r1,[r2,#0xc]  ; baro_ctrl
;;;413    				baro_ctrl.err_old=0;				
000098  6051              STR      r1,[r2,#4]  ; baro_ctrl
;;;414    			  lock_BARO=1;				
00009a  2101              MOVS     r1,#1
00009c  4a11              LDR      r2,|L5.228|
00009e  7011              STRB     r1,[r2,#0]
0000a0  e00a              B        |L5.184|
                  |L5.162|
;;;415        }
;;;416    		else if(flag.FlightMode==MANUAL_High || flag.FlightMode==ULTRASONIC_High)
0000a2  4906              LDR      r1,|L5.188|
0000a4  7cc9              LDRB     r1,[r1,#0x13]  ; flag
0000a6  2901              CMP      r1,#1
0000a8  d003              BEQ      |L5.178|
0000aa  4904              LDR      r1,|L5.188|
0000ac  7cc9              LDRB     r1,[r1,#0x13]  ; flag
0000ae  2902              CMP      r1,#2
0000b0  d102              BNE      |L5.184|
                  |L5.178|
;;;417    		{lock_BARO=0;}					
0000b2  2100              MOVS     r1,#0
0000b4  4a0b              LDR      r2,|L5.228|
0000b6  7011              STRB     r1,[r2,#0]
                  |L5.184|
;;;418    }
0000b8  4770              BX       lr
                          ENDP

0000ba  0000              DCW      0x0000
                  |L5.188|
                          DCD      flag
                  |L5.192|
                          DCD      lock
                  |L5.196|
                          DCD      ultra_wz_speed_pid
                  |L5.200|
                          DCD      wz_speed_pid
                  |L5.204|
                          DCD      ultra_dis_lpf
                  |L5.208|
                          DCD      exp_height
                  |L5.212|
                          DCD      wz_acc
                  |L5.216|
                          DCD      wz_speed_pid_v
                  |L5.220|
                          DCD      ultra_speed
                  |L5.224|
                          DCD      ultra_ctrl
                  |L5.228|
                          DCD      lock_BARO
                  |L5.232|
                          DCD      baro_wz_speed_pid
                  |L5.236|
                          DCD      baro_dis_lpf
                  |L5.240|
                          DCD      baro_speed
                  |L5.244|
                          DCD      baro_speed_lpf
                  |L5.248|
                          DCD      baro_ctrl

                          AREA ||i.Ultra_Ctrl||, CODE, READONLY, ALIGN=2

                  Ultra_Ctrl PROC
;;;346    
;;;347    void Ultra_Ctrl(float T,float thr)
000000  e92d47f0          PUSH     {r4-r10,lr}
;;;348    {
000004  4604              MOV      r4,r0
000006  460d              MOV      r5,r1
;;;349    		exp_height_speed = ULTRA_SPEED *my_deathzoom_2(thr - 500,100)/300.0f; //20这里具体根据自己起飞油门定，油门控制高度+-ULTRA_SPEEDmm / s
000008  4985              LDR      r1,|L6.544|
00000a  4628              MOV      r0,r5
00000c  f7fffffe          BL       __aeabi_fsub
000010  4680              MOV      r8,r0
000012  4984              LDR      r1,|L6.548|
000014  f7fffffe          BL       my_deathzoom_2
000018  4607              MOV      r7,r0
00001a  4983              LDR      r1,|L6.552|
00001c  f7fffffe          BL       __aeabi_fmul
000020  4606              MOV      r6,r0
000022  4981              LDR      r1,|L6.552|
000024  f7fffffe          BL       __aeabi_fdiv
000028  4980              LDR      r1,|L6.556|
00002a  6008              STR      r0,[r1,#0]  ; exp_height_speed
;;;350    		exp_height_speed = LIMIT(exp_height_speed ,-ULTRA_SPEED,ULTRA_SPEED);
00002c  4980              LDR      r1,|L6.560|
00002e  487f              LDR      r0,|L6.556|
000030  6800              LDR      r0,[r0,#0]  ; exp_height_speed
000032  f7fffffe          BL       __aeabi_cfcmple
000036  d201              BCS      |L6.60|
000038  487d              LDR      r0,|L6.560|
00003a  e009              B        |L6.80|
                  |L6.60|
00003c  497a              LDR      r1,|L6.552|
00003e  487b              LDR      r0,|L6.556|
000040  6800              LDR      r0,[r0,#0]  ; exp_height_speed
000042  f7fffffe          BL       __aeabi_cfrcmple
000046  d201              BCS      |L6.76|
000048  4877              LDR      r0,|L6.552|
00004a  e001              B        |L6.80|
                  |L6.76|
00004c  4877              LDR      r0,|L6.556|
00004e  6800              LDR      r0,[r0,#0]  ; exp_height_speed
                  |L6.80|
000050  4976              LDR      r1,|L6.556|
000052  6008              STR      r0,[r1,#0]  ; exp_height_speed
;;;351    		
;;;352    		if( exp_height > Ultrasonic_MAX_Height )//超出超声波高度稳定范围则不执行
000054  4977              LDR      r1,|L6.564|
000056  4878              LDR      r0,|L6.568|
000058  6800              LDR      r0,[r0,#0]  ; exp_height
00005a  f7fffffe          BL       __aeabi_cfrcmple
00005e  d209              BCS      |L6.116|
;;;353    		{
;;;354    			if( exp_height_speed > 0 )
000060  2100              MOVS     r1,#0
000062  4872              LDR      r0,|L6.556|
000064  6800              LDR      r0,[r0,#0]  ; exp_height_speed
000066  f7fffffe          BL       __aeabi_cfrcmple
00006a  d212              BCS      |L6.146|
;;;355    			{
;;;356    				exp_height_speed = 0;
00006c  2000              MOVS     r0,#0
00006e  496f              LDR      r1,|L6.556|
000070  6008              STR      r0,[r1,#0]  ; exp_height_speed
000072  e00e              B        |L6.146|
                  |L6.116|
;;;357    			}
;;;358    		}
;;;359    		else if( exp_height < Ultrasonic_MIN_Height )
000074  4971              LDR      r1,|L6.572|
000076  4870              LDR      r0,|L6.568|
000078  6800              LDR      r0,[r0,#0]  ; exp_height
00007a  f7fffffe          BL       __aeabi_cfcmple
00007e  d208              BCS      |L6.146|
;;;360    		{
;;;361    			if( exp_height_speed < 0 )
000080  2100              MOVS     r1,#0
000082  486a              LDR      r0,|L6.556|
000084  6800              LDR      r0,[r0,#0]  ; exp_height_speed
000086  f7fffffe          BL       __aeabi_cfcmple
00008a  d202              BCS      |L6.146|
;;;362    			{
;;;363    				exp_height_speed = 0;
00008c  2000              MOVS     r0,#0
00008e  4967              LDR      r1,|L6.556|
000090  6008              STR      r0,[r1,#0]  ; exp_height_speed
                  |L6.146|
;;;364    			}
;;;365    		}
;;;366    		
;;;367    		exp_height += exp_height_speed *T;//累积期望高度，因为期望速度可能改变了
000092  4866              LDR      r0,|L6.556|
000094  6801              LDR      r1,[r0,#0]  ; exp_height_speed
000096  4620              MOV      r0,r4
000098  f7fffffe          BL       __aeabi_fmul
00009c  4606              MOV      r6,r0
00009e  4866              LDR      r0,|L6.568|
0000a0  6801              LDR      r1,[r0,#0]  ; exp_height
0000a2  4630              MOV      r0,r6
0000a4  f7fffffe          BL       __aeabi_fadd
0000a8  4963              LDR      r1,|L6.568|
0000aa  6008              STR      r0,[r1,#0]  ; exp_height
;;;368    
;;;369    		ultra_ctrl.err = ( ultra_pid.kp*(exp_height - ultra_dis_lpf) );//mm 对高度误差乘以Kp
0000ac  4864              LDR      r0,|L6.576|
0000ae  6801              LDR      r1,[r0,#0]  ; ultra_dis_lpf
0000b0  4861              LDR      r0,|L6.568|
0000b2  6800              LDR      r0,[r0,#0]  ; exp_height
0000b4  f7fffffe          BL       __aeabi_fsub
0000b8  4606              MOV      r6,r0
0000ba  4862              LDR      r0,|L6.580|
0000bc  6801              LDR      r1,[r0,#0]  ; ultra_pid
0000be  4630              MOV      r0,r6
0000c0  f7fffffe          BL       __aeabi_fmul
0000c4  4960              LDR      r1,|L6.584|
0000c6  6008              STR      r0,[r1,#0]  ; ultra_ctrl
;;;370    		userdata2[5]=ultra_ctrl.err;
0000c8  4608              MOV      r0,r1
0000ca  6800              LDR      r0,[r0,#0]  ; ultra_ctrl
0000cc  495f              LDR      r1,|L6.588|
0000ce  6148              STR      r0,[r1,#0x14]  ; userdata2
;;;371    		ultra_ctrl.err_i += ultra_pid.ki *ultra_ctrl.err *T;//对高度误差积分
0000d0  4a5d              LDR      r2,|L6.584|
0000d2  6811              LDR      r1,[r2,#0]  ; ultra_ctrl
0000d4  4a5b              LDR      r2,|L6.580|
0000d6  6890              LDR      r0,[r2,#8]  ; ultra_pid
0000d8  f7fffffe          BL       __aeabi_fmul
0000dc  4607              MOV      r7,r0
0000de  4621              MOV      r1,r4
0000e0  f7fffffe          BL       __aeabi_fmul
0000e4  4606              MOV      r6,r0
0000e6  4858              LDR      r0,|L6.584|
0000e8  68c1              LDR      r1,[r0,#0xc]  ; ultra_ctrl
0000ea  4630              MOV      r0,r6
0000ec  f7fffffe          BL       __aeabi_fadd
0000f0  4955              LDR      r1,|L6.584|
0000f2  60c8              STR      r0,[r1,#0xc]  ; ultra_ctrl
;;;372    		userdata2[6]=ultra_ctrl.err_i = LIMIT(ultra_ctrl.err_i,-Thr_Weight *ULTRA_INT,Thr_Weight *ULTRA_INT);//积分限幅，融合了油门权重
0000f4  4856              LDR      r0,|L6.592|
0000f6  6800              LDR      r0,[r0,#0]  ; Thr_Weight
0000f8  f0804700          EOR      r7,r0,#0x80000000
0000fc  494a              LDR      r1,|L6.552|
0000fe  4638              MOV      r0,r7
000100  f7fffffe          BL       __aeabi_fmul
000104  4606              MOV      r6,r0
000106  4850              LDR      r0,|L6.584|
000108  68c1              LDR      r1,[r0,#0xc]  ; ultra_ctrl
00010a  4630              MOV      r0,r6
00010c  f7fffffe          BL       __aeabi_cfrcmple
000110  d208              BCS      |L6.292|
000112  484f              LDR      r0,|L6.592|
000114  6800              LDR      r0,[r0,#0]  ; Thr_Weight
000116  f0804600          EOR      r6,r0,#0x80000000
00011a  4943              LDR      r1,|L6.552|
00011c  4630              MOV      r0,r6
00011e  f7fffffe          BL       __aeabi_fmul
000122  e013              B        |L6.332|
                  |L6.292|
000124  4940              LDR      r1,|L6.552|
000126  484a              LDR      r0,|L6.592|
000128  6800              LDR      r0,[r0,#0]  ; Thr_Weight
00012a  f7fffffe          BL       __aeabi_fmul
00012e  4606              MOV      r6,r0
000130  4845              LDR      r0,|L6.584|
000132  68c1              LDR      r1,[r0,#0xc]  ; ultra_ctrl
000134  4630              MOV      r0,r6
000136  f7fffffe          BL       __aeabi_cfcmple
00013a  d205              BCS      |L6.328|
00013c  493a              LDR      r1,|L6.552|
00013e  4844              LDR      r0,|L6.592|
000140  6800              LDR      r0,[r0,#0]  ; Thr_Weight
000142  f7fffffe          BL       __aeabi_fmul
000146  e001              B        |L6.332|
                  |L6.328|
000148  483f              LDR      r0,|L6.584|
00014a  68c0              LDR      r0,[r0,#0xc]  ; ultra_ctrl
                  |L6.332|
00014c  493e              LDR      r1,|L6.584|
00014e  60c8              STR      r0,[r1,#0xc]  ; ultra_ctrl
000150  493e              LDR      r1,|L6.588|
000152  6188              STR      r0,[r1,#0x18]  ; userdata2
;;;373    					//对于D，融合了加速度计运算得到的距离	
;;;374    		userdata2[7]=0.4f *(ultra_ctrl.err_old - ultra_ctrl.err);
000154  4a3c              LDR      r2,|L6.584|
000156  6811              LDR      r1,[r2,#0]  ; ultra_ctrl
000158  6850              LDR      r0,[r2,#4]  ; ultra_ctrl
00015a  f7fffffe          BL       __aeabi_fsub
00015e  4606              MOV      r6,r0
000160  493c              LDR      r1,|L6.596|
000162  f7fffffe          BL       __aeabi_fmul
000166  4939              LDR      r1,|L6.588|
000168  61c8              STR      r0,[r1,#0x1c]  ; userdata2
;;;375    		ultra_ctrl.err_d = ultra_pid.kd *( 0.5f *(-wz_speed*T) + 0.5f *(ultra_ctrl.err - ultra_ctrl.err_old) );
00016a  4a37              LDR      r2,|L6.584|
00016c  6851              LDR      r1,[r2,#4]  ; ultra_ctrl
00016e  6810              LDR      r0,[r2,#0]  ; ultra_ctrl
000170  f7fffffe          BL       __aeabi_fsub
000174  4681              MOV      r9,r0
000176  f04f517c          MOV      r1,#0x3f000000
00017a  f7fffffe          BL       __aeabi_fmul
00017e  4607              MOV      r7,r0
000180  4835              LDR      r0,|L6.600|
000182  6800              LDR      r0,[r0,#0]  ; wz_speed
000184  f0804a00          EOR      r10,r0,#0x80000000
000188  4621              MOV      r1,r4
00018a  4650              MOV      r0,r10
00018c  f7fffffe          BL       __aeabi_fmul
000190  4681              MOV      r9,r0
000192  f04f517c          MOV      r1,#0x3f000000
000196  f7fffffe          BL       __aeabi_fmul
00019a  4680              MOV      r8,r0
00019c  4639              MOV      r1,r7
00019e  f7fffffe          BL       __aeabi_fadd
0001a2  4606              MOV      r6,r0
0001a4  4827              LDR      r0,|L6.580|
0001a6  6841              LDR      r1,[r0,#4]  ; ultra_pid
0001a8  4630              MOV      r0,r6
0001aa  f7fffffe          BL       __aeabi_fmul
0001ae  4926              LDR      r1,|L6.584|
0001b0  6088              STR      r0,[r1,#8]  ; ultra_ctrl
;;;376    		userdata2[8]=ultra_ctrl.err_d;
0001b2  4608              MOV      r0,r1
0001b4  6880              LDR      r0,[r0,#8]  ; ultra_ctrl
0001b6  4925              LDR      r1,|L6.588|
0001b8  6208              STR      r0,[r1,#0x20]  ; userdata2
;;;377    		ultra_ctrl.pid_out = ultra_ctrl.err + ultra_ctrl.err_i + ultra_ctrl.err_d;	
0001ba  4a23              LDR      r2,|L6.584|
0001bc  68d1              LDR      r1,[r2,#0xc]  ; ultra_ctrl
0001be  6810              LDR      r0,[r2,#0]  ; ultra_ctrl
0001c0  f7fffffe          BL       __aeabi_fadd
0001c4  4606              MOV      r6,r0
0001c6  4820              LDR      r0,|L6.584|
0001c8  6881              LDR      r1,[r0,#8]  ; ultra_ctrl
0001ca  4630              MOV      r0,r6
0001cc  f7fffffe          BL       __aeabi_fadd
0001d0  491d              LDR      r1,|L6.584|
0001d2  6108              STR      r0,[r1,#0x10]  ; ultra_ctrl
;;;378    		ultra_ctrl.pid_out = LIMIT(ultra_ctrl.pid_out,-500,500);
0001d4  6908              LDR      r0,[r1,#0x10]  ; ultra_ctrl
0001d6  4921              LDR      r1,|L6.604|
0001d8  f7fffffe          BL       __aeabi_cfcmple
0001dc  d201              BCS      |L6.482|
0001de  481f              LDR      r0,|L6.604|
0001e0  e009              B        |L6.502|
                  |L6.482|
0001e2  4919              LDR      r1,|L6.584|
0001e4  6908              LDR      r0,[r1,#0x10]  ; ultra_ctrl
0001e6  490e              LDR      r1,|L6.544|
0001e8  f7fffffe          BL       __aeabi_cfrcmple
0001ec  d201              BCS      |L6.498|
0001ee  480c              LDR      r0,|L6.544|
0001f0  e001              B        |L6.502|
                  |L6.498|
0001f2  4815              LDR      r0,|L6.584|
0001f4  6900              LDR      r0,[r0,#0x10]  ; ultra_ctrl
                  |L6.502|
0001f6  4914              LDR      r1,|L6.584|
0001f8  6108              STR      r0,[r1,#0x10]  ; ultra_ctrl
;;;379    		
;;;380    		if(flag.Special_Mode==ACC_High)ultra_ctrl.pid_out=0;//加入这代码用于测试加速度计定高效果,但仍然有速度反馈	
0001fa  4819              LDR      r0,|L6.608|
0001fc  7d80              LDRB     r0,[r0,#0x16]  ; flag
0001fe  2806              CMP      r0,#6
000200  d101              BNE      |L6.518|
000202  2000              MOVS     r0,#0
000204  6108              STR      r0,[r1,#0x10]  ; ultra_ctrl
                  |L6.518|
;;;381    		userdata2[9]=ultra_ctrl_out = ultra_ctrl.pid_out;
000206  4810              LDR      r0,|L6.584|
000208  6900              LDR      r0,[r0,#0x10]  ; ultra_ctrl
00020a  4916              LDR      r1,|L6.612|
00020c  6008              STR      r0,[r1,#0]  ; ultra_ctrl_out
00020e  490f              LDR      r1,|L6.588|
000210  6248              STR      r0,[r1,#0x24]  ; userdata2
;;;382    		ultra_ctrl.err_old = ultra_ctrl.err;
000212  480d              LDR      r0,|L6.584|
000214  6800              LDR      r0,[r0,#0]  ; ultra_ctrl
000216  490c              LDR      r1,|L6.584|
000218  6048              STR      r0,[r1,#4]  ; ultra_ctrl
;;;383    }
00021a  e8bd87f0          POP      {r4-r10,pc}
;;;384    
                          ENDP

00021e  0000              DCW      0x0000
                  |L6.544|
                          DCD      0x43fa0000
                  |L6.548|
                          DCD      0x42c80000
                  |L6.552|
                          DCD      0x43960000
                  |L6.556|
                          DCD      exp_height_speed
                  |L6.560|
                          DCD      0xc3960000
                  |L6.564|
                          DCD      0x451c4000
                  |L6.568|
                          DCD      exp_height
                  |L6.572|
                          DCD      0x43480000
                  |L6.576|
                          DCD      ultra_dis_lpf
                  |L6.580|
                          DCD      ultra_pid
                  |L6.584|
                          DCD      ultra_ctrl
                  |L6.588|
                          DCD      userdata2
                  |L6.592|
                          DCD      Thr_Weight
                  |L6.596|
                          DCD      0x3ecccccd
                  |L6.600|
                          DCD      wz_speed
                  |L6.604|
                          DCD      0xc3fa0000
                  |L6.608|
                          DCD      flag
                  |L6.612|
                          DCD      ultra_ctrl_out

                          AREA ||i.Ultra_PID_Init||, CODE, READONLY, ALIGN=2

                  Ultra_PID_Init PROC
;;;298    
;;;299    void Ultra_PID_Init()
000000  f04f507c          MOV      r0,#0x3f000000
;;;300    {
;;;301    		ultra_pid.kp = 0.5;//超声波定高的高度位置环PID，会被EEPROM里的重新赋值的
000004  4903              LDR      r1,|L7.20|
000006  6008              STR      r0,[r1,#0]  ; ultra_pid
;;;302    		ultra_pid.ki = 0;
000008  2000              MOVS     r0,#0
00000a  6088              STR      r0,[r1,#8]  ; ultra_pid
;;;303    		ultra_pid.kd = 2.5;	//2.5
00000c  4802              LDR      r0,|L7.24|
00000e  6048              STR      r0,[r1,#4]  ; ultra_pid
;;;304    }
000010  4770              BX       lr
;;;305    
                          ENDP

000012  0000              DCW      0x0000
                  |L7.20|
                          DCD      ultra_pid
                  |L7.24|
                          DCD      0x40200000

                          AREA ||i.Ultra_dataporcess||, CODE, READONLY, ALIGN=2

                  Ultra_dataporcess PROC
;;;305    
;;;306    void Ultra_dataporcess(float T)
000000  e92d4ff8          PUSH     {r3-r11,lr}
;;;307    {
000004  4605              MOV      r5,r0
;;;308    		float ultra_sp_tmp,ultra_dis_tmp;	
;;;309    		ultra_dis_tmp = Moving_Median(1,5,US100_Alt);//对超声波测量的距离进行移动中位值滤波
000006  48b8              LDR      r0,|L8.744|
000008  2105              MOVS     r1,#5
00000a  6802              LDR      r2,[r0,#0]  ; US100_Alt
00000c  2001              MOVS     r0,#1
00000e  f7fffffe          BL       Moving_Median
000012  4606              MOV      r6,r0
;;;310    		userdata2[1]=ultra_dis_tmp;
000014  48b5              LDR      r0,|L8.748|
000016  6046              STR      r6,[r0,#4]  ; userdata2
;;;311    		if( ultra_dis_tmp < Ultrasonic_MAX_Height )
000018  49b5              LDR      r1,|L8.752|
00001a  4630              MOV      r0,r6
00001c  f7fffffe          BL       __aeabi_cfcmple
000020  d242              BCS      |L8.168|
;;;312    		{	
;;;313    			if( ABS(ultra_dis_tmp - ultra_dis_lpf) < 100 )
000022  48b4              LDR      r0,|L8.756|
000024  6801              LDR      r1,[r0,#0]  ; ultra_dis_lpf
000026  4630              MOV      r0,r6
000028  f7fffffe          BL       __aeabi_fsub
00002c  4680              MOV      r8,r0
00002e  2100              MOVS     r1,#0
000030  f7fffffe          BL       __aeabi_cfrcmple
000034  d205              BCS      |L8.66|
000036  48af              LDR      r0,|L8.756|
000038  6801              LDR      r1,[r0,#0]  ; ultra_dis_lpf
00003a  4630              MOV      r0,r6
00003c  f7fffffe          BL       __aeabi_fsub
000040  e006              B        |L8.80|
                  |L8.66|
000042  48ac              LDR      r0,|L8.756|
000044  6801              LDR      r1,[r0,#0]  ; ultra_dis_lpf
000046  4630              MOV      r0,r6
000048  f7fffffe          BL       __aeabi_fsub
00004c  f0804000          EOR      r0,r0,#0x80000000
                  |L8.80|
000050  4607              MOV      r7,r0
000052  49a9              LDR      r1,|L8.760|
000054  f7fffffe          BL       __aeabi_cfcmple
000058  d227              BCS      |L8.170|
;;;314    			{	
;;;315    				ultra_dis_lpf += ( 1 / ( 1 + 1 / ( 4.0f *3.14f *T ) ) ) *(ultra_dis_tmp - ultra_dis_lpf) ;
00005a  48a6              LDR      r0,|L8.756|
00005c  6801              LDR      r1,[r0,#0]  ; ultra_dis_lpf
00005e  4630              MOV      r0,r6
000060  f7fffffe          BL       __aeabi_fsub
000064  4683              MOV      r11,r0
000066  49a5              LDR      r1,|L8.764|
000068  4628              MOV      r0,r5
00006a  f7fffffe          BL       __aeabi_fmul
00006e  4601              MOV      r1,r0
000070  9000              STR      r0,[sp,#0]
000072  f04f507e          MOV      r0,#0x3f800000
000076  f7fffffe          BL       __aeabi_fdiv
00007a  4682              MOV      r10,r0
00007c  f04f517e          MOV      r1,#0x3f800000
000080  f7fffffe          BL       __aeabi_fadd
000084  4681              MOV      r9,r0
000086  4649              MOV      r1,r9
000088  f04f507e          MOV      r0,#0x3f800000
00008c  f7fffffe          BL       __aeabi_fdiv
000090  4680              MOV      r8,r0
000092  4659              MOV      r1,r11
000094  f7fffffe          BL       __aeabi_fmul
000098  4607              MOV      r7,r0
00009a  4896              LDR      r0,|L8.756|
00009c  6801              LDR      r1,[r0,#0]  ; ultra_dis_lpf
00009e  4638              MOV      r0,r7
0000a0  f7fffffe          BL       __aeabi_fadd
0000a4  4993              LDR      r1,|L8.756|
0000a6  6008              STR      r0,[r1,#0]  ; ultra_dis_lpf
                  |L8.168|
0000a8  e0ae              B        |L8.520|
                  |L8.170|
;;;316    			}
;;;317    			else if( ABS(ultra_dis_tmp - ultra_dis_lpf) < 200 )
0000aa  4892              LDR      r0,|L8.756|
0000ac  6801              LDR      r1,[r0,#0]  ; ultra_dis_lpf
0000ae  4630              MOV      r0,r6
0000b0  f7fffffe          BL       __aeabi_fsub
0000b4  4680              MOV      r8,r0
0000b6  2100              MOVS     r1,#0
0000b8  f7fffffe          BL       __aeabi_cfrcmple
0000bc  d205              BCS      |L8.202|
0000be  488d              LDR      r0,|L8.756|
0000c0  6801              LDR      r1,[r0,#0]  ; ultra_dis_lpf
0000c2  4630              MOV      r0,r6
0000c4  f7fffffe          BL       __aeabi_fsub
0000c8  e006              B        |L8.216|
                  |L8.202|
0000ca  488a              LDR      r0,|L8.756|
0000cc  6801              LDR      r1,[r0,#0]  ; ultra_dis_lpf
0000ce  4630              MOV      r0,r6
0000d0  f7fffffe          BL       __aeabi_fsub
0000d4  f0804000          EOR      r0,r0,#0x80000000
                  |L8.216|
0000d8  4607              MOV      r7,r0
0000da  4989              LDR      r1,|L8.768|
0000dc  f7fffffe          BL       __aeabi_cfcmple
0000e0  d227              BCS      |L8.306|
;;;318    			{			
;;;319    				ultra_dis_lpf += ( 1 / ( 1 + 1 / ( 2.2f *3.14f *T ) ) ) *(ultra_dis_tmp- ultra_dis_lpf) ;
0000e2  4884              LDR      r0,|L8.756|
0000e4  6801              LDR      r1,[r0,#0]  ; ultra_dis_lpf
0000e6  4630              MOV      r0,r6
0000e8  f7fffffe          BL       __aeabi_fsub
0000ec  4683              MOV      r11,r0
0000ee  4985              LDR      r1,|L8.772|
0000f0  4628              MOV      r0,r5
0000f2  f7fffffe          BL       __aeabi_fmul
0000f6  4601              MOV      r1,r0
0000f8  9000              STR      r0,[sp,#0]
0000fa  f04f507e          MOV      r0,#0x3f800000
0000fe  f7fffffe          BL       __aeabi_fdiv
000102  4682              MOV      r10,r0
000104  f04f517e          MOV      r1,#0x3f800000
000108  f7fffffe          BL       __aeabi_fadd
00010c  4681              MOV      r9,r0
00010e  4649              MOV      r1,r9
000110  f04f507e          MOV      r0,#0x3f800000
000114  f7fffffe          BL       __aeabi_fdiv
000118  4680              MOV      r8,r0
00011a  4659              MOV      r1,r11
00011c  f7fffffe          BL       __aeabi_fmul
000120  4607              MOV      r7,r0
000122  4874              LDR      r0,|L8.756|
000124  6801              LDR      r1,[r0,#0]  ; ultra_dis_lpf
000126  4638              MOV      r0,r7
000128  f7fffffe          BL       __aeabi_fadd
00012c  4971              LDR      r1,|L8.756|
00012e  6008              STR      r0,[r1,#0]  ; ultra_dis_lpf
000130  e06a              B        |L8.520|
                  |L8.306|
;;;320    			}
;;;321    			else if( ABS(ultra_dis_tmp - ultra_dis_lpf) < 400 )
000132  4870              LDR      r0,|L8.756|
000134  6801              LDR      r1,[r0,#0]  ; ultra_dis_lpf
000136  4630              MOV      r0,r6
000138  f7fffffe          BL       __aeabi_fsub
00013c  4680              MOV      r8,r0
00013e  2100              MOVS     r1,#0
000140  f7fffffe          BL       __aeabi_cfrcmple
000144  d205              BCS      |L8.338|
000146  486b              LDR      r0,|L8.756|
000148  6801              LDR      r1,[r0,#0]  ; ultra_dis_lpf
00014a  4630              MOV      r0,r6
00014c  f7fffffe          BL       __aeabi_fsub
000150  e006              B        |L8.352|
                  |L8.338|
000152  4868              LDR      r0,|L8.756|
000154  6801              LDR      r1,[r0,#0]  ; ultra_dis_lpf
000156  4630              MOV      r0,r6
000158  f7fffffe          BL       __aeabi_fsub
00015c  f0804000          EOR      r0,r0,#0x80000000
                  |L8.352|
000160  4607              MOV      r7,r0
000162  4969              LDR      r1,|L8.776|
000164  f7fffffe          BL       __aeabi_cfcmple
000168  d227              BCS      |L8.442|
;;;322    			{
;;;323    				ultra_dis_lpf += ( 1 / ( 1 + 1 / ( 1.2f *3.14f *T ) ) ) *(ultra_dis_tmp- ultra_dis_lpf) ;
00016a  4862              LDR      r0,|L8.756|
00016c  6801              LDR      r1,[r0,#0]  ; ultra_dis_lpf
00016e  4630              MOV      r0,r6
000170  f7fffffe          BL       __aeabi_fsub
000174  4965              LDR      r1,|L8.780|
000176  9000              STR      r0,[sp,#0]
000178  4628              MOV      r0,r5
00017a  f7fffffe          BL       __aeabi_fmul
00017e  4683              MOV      r11,r0
000180  4659              MOV      r1,r11
000182  f04f507e          MOV      r0,#0x3f800000
000186  f7fffffe          BL       __aeabi_fdiv
00018a  4682              MOV      r10,r0
00018c  f04f517e          MOV      r1,#0x3f800000
000190  f7fffffe          BL       __aeabi_fadd
000194  4681              MOV      r9,r0
000196  4649              MOV      r1,r9
000198  f04f507e          MOV      r0,#0x3f800000
00019c  f7fffffe          BL       __aeabi_fdiv
0001a0  4680              MOV      r8,r0
0001a2  9900              LDR      r1,[sp,#0]
0001a4  f7fffffe          BL       __aeabi_fmul
0001a8  4607              MOV      r7,r0
0001aa  4852              LDR      r0,|L8.756|
0001ac  6801              LDR      r1,[r0,#0]  ; ultra_dis_lpf
0001ae  4638              MOV      r0,r7
0001b0  f7fffffe          BL       __aeabi_fadd
0001b4  494f              LDR      r1,|L8.756|
0001b6  6008              STR      r0,[r1,#0]  ; ultra_dis_lpf
0001b8  e026              B        |L8.520|
                  |L8.442|
;;;324    			}
;;;325    			else
;;;326    			{
;;;327    				ultra_dis_lpf += ( 1 / ( 1 + 1 / ( 0.2f *3.14f *T ) ) ) *(ultra_dis_tmp- ultra_dis_lpf) ;
0001ba  484e              LDR      r0,|L8.756|
0001bc  6801              LDR      r1,[r0,#0]  ; ultra_dis_lpf
0001be  4630              MOV      r0,r6
0001c0  f7fffffe          BL       __aeabi_fsub
0001c4  4952              LDR      r1,|L8.784|
0001c6  9000              STR      r0,[sp,#0]
0001c8  4628              MOV      r0,r5
0001ca  f7fffffe          BL       __aeabi_fmul
0001ce  4683              MOV      r11,r0
0001d0  4659              MOV      r1,r11
0001d2  f04f507e          MOV      r0,#0x3f800000
0001d6  f7fffffe          BL       __aeabi_fdiv
0001da  4682              MOV      r10,r0
0001dc  f04f517e          MOV      r1,#0x3f800000
0001e0  f7fffffe          BL       __aeabi_fadd
0001e4  4681              MOV      r9,r0
0001e6  4649              MOV      r1,r9
0001e8  f04f507e          MOV      r0,#0x3f800000
0001ec  f7fffffe          BL       __aeabi_fdiv
0001f0  4680              MOV      r8,r0
0001f2  9900              LDR      r1,[sp,#0]
0001f4  f7fffffe          BL       __aeabi_fmul
0001f8  4607              MOV      r7,r0
0001fa  483e              LDR      r0,|L8.756|
0001fc  6801              LDR      r1,[r0,#0]  ; ultra_dis_lpf
0001fe  4638              MOV      r0,r7
000200  f7fffffe          BL       __aeabi_fadd
000204  493b              LDR      r1,|L8.756|
000206  6008              STR      r0,[r1,#0]  ; ultra_dis_lpf
                  |L8.520|
;;;328    			}
;;;329    		}
;;;330    		
;;;331    		//注意超声波测量的 距离的时效性问题，避免反复被计算
;;;332    		ultra_sp_tmp = Moving_Median(0,5,US100_Alt_delta/T); //对超声波测距出来两次之间距离差计算的速度中值滤波 ultra_delta/T;
000208  4629              MOV      r1,r5
00020a  4842              LDR      r0,|L8.788|
00020c  6800              LDR      r0,[r0,#0]  ; US100_Alt_delta
00020e  f7fffffe          BL       __aeabi_fdiv
000212  4607              MOV      r7,r0
000214  463a              MOV      r2,r7
000216  2105              MOVS     r1,#5
000218  2000              MOVS     r0,#0
00021a  f7fffffe          BL       Moving_Median
00021e  4604              MOV      r4,r0
;;;333    
;;;334    		if( ultra_dis_tmp < Ultrasonic_MAX_Height )//小于3米,注意这里，万一超出了呢？
000220  4933              LDR      r1,|L8.752|
000222  4630              MOV      r0,r6
000224  f7fffffe          BL       __aeabi_cfcmple
000228  d25c              BCS      |L8.740|
;;;335    		{
;;;336    			if( ABS(ultra_sp_tmp) < 100 )//运动速度小于100mm/s
00022a  2100              MOVS     r1,#0
00022c  4620              MOV      r0,r4
00022e  f7fffffe          BL       __aeabi_cfrcmple
000232  d201              BCS      |L8.568|
000234  4620              MOV      r0,r4
000236  e001              B        |L8.572|
                  |L8.568|
000238  f0844000          EOR      r0,r4,#0x80000000
                  |L8.572|
00023c  4607              MOV      r7,r0
00023e  492e              LDR      r1,|L8.760|
000240  f7fffffe          BL       __aeabi_cfcmple
000244  d227              BCS      |L8.662|
;;;337    			{
;;;338    				ultra_speed += ( 1 / ( 1 + 1 / ( 4 *3.14f *T ) ) ) * ( (float)(ultra_sp_tmp) - ultra_speed );
000246  4834              LDR      r0,|L8.792|
000248  6801              LDR      r1,[r0,#0]  ; ultra_speed
00024a  4620              MOV      r0,r4
00024c  f7fffffe          BL       __aeabi_fsub
000250  492a              LDR      r1,|L8.764|
000252  9000              STR      r0,[sp,#0]
000254  4628              MOV      r0,r5
000256  f7fffffe          BL       __aeabi_fmul
00025a  4683              MOV      r11,r0
00025c  4659              MOV      r1,r11
00025e  f04f507e          MOV      r0,#0x3f800000
000262  f7fffffe          BL       __aeabi_fdiv
000266  4682              MOV      r10,r0
000268  f04f517e          MOV      r1,#0x3f800000
00026c  f7fffffe          BL       __aeabi_fadd
000270  4681              MOV      r9,r0
000272  4649              MOV      r1,r9
000274  f04f507e          MOV      r0,#0x3f800000
000278  f7fffffe          BL       __aeabi_fdiv
00027c  4680              MOV      r8,r0
00027e  9900              LDR      r1,[sp,#0]
000280  f7fffffe          BL       __aeabi_fmul
000284  4607              MOV      r7,r0
000286  4824              LDR      r0,|L8.792|
000288  6801              LDR      r1,[r0,#0]  ; ultra_speed
00028a  4638              MOV      r0,r7
00028c  f7fffffe          BL       __aeabi_fadd
000290  4921              LDR      r1,|L8.792|
000292  6008              STR      r0,[r1,#0]  ; ultra_speed
000294  e026              B        |L8.740|
                  |L8.662|
;;;339    			}//ultra_speed会传递给速度环，作为当前速度的反馈,原来是4
;;;340    			else
;;;341    			{
;;;342    				ultra_speed += ( 1 / ( 1 + 1 / ( 1.0f *3.14f *T ) ) ) * ( (float)(ultra_sp_tmp) - ultra_speed );
000296  4820              LDR      r0,|L8.792|
000298  6801              LDR      r1,[r0,#0]  ; ultra_speed
00029a  4620              MOV      r0,r4
00029c  f7fffffe          BL       __aeabi_fsub
0002a0  491e              LDR      r1,|L8.796|
0002a2  9000              STR      r0,[sp,#0]
0002a4  4628              MOV      r0,r5
0002a6  f7fffffe          BL       __aeabi_fmul
0002aa  4683              MOV      r11,r0
0002ac  4659              MOV      r1,r11
0002ae  f04f507e          MOV      r0,#0x3f800000
0002b2  f7fffffe          BL       __aeabi_fdiv
0002b6  4682              MOV      r10,r0
0002b8  f04f517e          MOV      r1,#0x3f800000
0002bc  f7fffffe          BL       __aeabi_fadd
0002c0  4681              MOV      r9,r0
0002c2  4649              MOV      r1,r9
0002c4  f04f507e          MOV      r0,#0x3f800000
0002c8  f7fffffe          BL       __aeabi_fdiv
0002cc  4680              MOV      r8,r0
0002ce  9900              LDR      r1,[sp,#0]
0002d0  f7fffffe          BL       __aeabi_fmul
0002d4  4607              MOV      r7,r0
0002d6  4810              LDR      r0,|L8.792|
0002d8  6801              LDR      r1,[r0,#0]  ; ultra_speed
0002da  4638              MOV      r0,r7
0002dc  f7fffffe          BL       __aeabi_fadd
0002e0  490d              LDR      r1,|L8.792|
0002e2  6008              STR      r0,[r1,#0]  ; ultra_speed
                  |L8.740|
;;;343    			}//系数越大作用越小，原来是1
;;;344    		}
;;;345    }
0002e4  e8bd8ff8          POP      {r3-r11,pc}
;;;346    
                          ENDP

                  |L8.744|
                          DCD      US100_Alt
                  |L8.748|
                          DCD      userdata2
                  |L8.752|
                          DCD      0x451c4000
                  |L8.756|
                          DCD      ultra_dis_lpf
                  |L8.760|
                          DCD      0x42c80000
                  |L8.764|
                          DCD      0x4148f5c3
                  |L8.768|
                          DCD      0x43480000
                  |L8.772|
                          DCD      0x40dd0e57
                  |L8.776|
                          DCD      0x43c80000
                  |L8.780|
                          DCD      0x407126eb
                  |L8.784|
                          DCD      0x3f20c49c
                  |L8.788|
                          DCD      US100_Alt_delta
                  |L8.792|
                          DCD      ultra_speed
                  |L8.796|
                          DCD      0x4048f5c3

                          AREA ||i.WZ_Speed_PID_Init||, CODE, READONLY, ALIGN=2

                  WZ_Speed_PID_Init PROC
;;;202    
;;;203    void WZ_Speed_PID_Init()
000000  f04f507a          MOV      r0,#0x3e800000
;;;204    {
;;;205    		ultra_wz_speed_pid.kp = 0.25;// //超声波定高的速度环PID，会被EEPROM里的重新赋值的
000004  490b              LDR      r1,|L9.52|
000006  6008              STR      r0,[r1,#0]  ; ultra_wz_speed_pid
;;;206    		ultra_wz_speed_pid.ki = 0.08; //0.12
000008  480b              LDR      r0,|L9.56|
00000a  6088              STR      r0,[r1,#8]  ; ultra_wz_speed_pid
;;;207    		ultra_wz_speed_pid.kd = 8;
00000c  f04f4082          MOV      r0,#0x41000000
000010  6048              STR      r0,[r1,#4]  ; ultra_wz_speed_pid
;;;208    		baro_wz_speed_pid.kp = 0.1;// 气压定高的速度环PID，会被EEPROM里的重新赋值的
000012  480a              LDR      r0,|L9.60|
000014  490a              LDR      r1,|L9.64|
000016  6008              STR      r0,[r1,#0]  ; baro_wz_speed_pid
;;;209    		baro_wz_speed_pid.ki = 0.06; 
000018  480a              LDR      r0,|L9.68|
00001a  6088              STR      r0,[r1,#8]  ; baro_wz_speed_pid
;;;210    		baro_wz_speed_pid.kd = 8;//1.4*10，在计算式乘以了10，已删除
00001c  f04f4082          MOV      r0,#0x41000000
000020  6048              STR      r0,[r1,#4]  ; baro_wz_speed_pid
;;;211    		wz_speed_pid.kp = 0.1;//速度环默认PID，真正用不到被重新赋值
000022  4806              LDR      r0,|L9.60|
000024  4908              LDR      r1,|L9.72|
000026  6008              STR      r0,[r1,#0]  ; wz_speed_pid
;;;212    		wz_speed_pid.ki = 0.08;
000028  4803              LDR      r0,|L9.56|
00002a  6088              STR      r0,[r1,#8]  ; wz_speed_pid
;;;213    		wz_speed_pid.kd = 8;
00002c  f04f4082          MOV      r0,#0x41000000
000030  6048              STR      r0,[r1,#4]  ; wz_speed_pid
;;;214    }
000032  4770              BX       lr
;;;215    
                          ENDP

                  |L9.52|
                          DCD      ultra_wz_speed_pid
                  |L9.56|
                          DCD      0x3da3d70a
                  |L9.60|
                          DCD      0x3dcccccd
                  |L9.64|
                          DCD      baro_wz_speed_pid
                  |L9.68|
                          DCD      0x3d75c28f
                  |L9.72|
                          DCD      wz_speed_pid

                          AREA ||i.height_speed_ctrl||, CODE, READONLY, ALIGN=2

                  height_speed_ctrl PROC
;;;215    
;;;216    void height_speed_ctrl(float T,float thr_keepheight,float exp_z_speed,float h_speed)
000000  e92d5ffc          PUSH     {r2-r12,lr}
;;;217    {
000004  4605              MOV      r5,r0
000006  460e              MOV      r6,r1
000008  4614              MOV      r4,r2
00000a  461f              MOV      r7,r3
;;;218        userdata1[1] =	thr_keepheight;
00000c  486a              LDR      r0,|L10.440|
00000e  6046              STR      r6,[r0,#4]  ; userdata1
;;;219    		//wz_speed被用于参与超声波高度D运算
;;;220    		userdata1[7]=wz_speed_pid_v.err = wz_speed_pid.kp *( exp_z_speed - wz_speed );//
000010  486a              LDR      r0,|L10.444|
000012  6801              LDR      r1,[r0,#0]  ; wz_speed
000014  4620              MOV      r0,r4
000016  f7fffffe          BL       __aeabi_fsub
00001a  4680              MOV      r8,r0
00001c  4868              LDR      r0,|L10.448|
00001e  6801              LDR      r1,[r0,#0]  ; wz_speed_pid
000020  4640              MOV      r0,r8
000022  f7fffffe          BL       __aeabi_fmul
000026  4967              LDR      r1,|L10.452|
000028  6008              STR      r0,[r1,#0]  ; wz_speed_pid_v
00002a  4963              LDR      r1,|L10.440|
00002c  61c8              STR      r0,[r1,#0x1c]  ; userdata1
;;;221    		userdata1[8]=wz_speed_pid_v.err_d = wz_speed_pid.kd * (-tempacc_lpf) *T;//(wz_speed_pid_v.err - wz_speed_pid_v.err_old);
00002e  4866              LDR      r0,|L10.456|
000030  6800              LDR      r0,[r0,#0]  ; tempacc_lpf
000032  f0804900          EOR      r9,r0,#0x80000000
000036  4862              LDR      r0,|L10.448|
000038  6841              LDR      r1,[r0,#4]  ; wz_speed_pid
00003a  4648              MOV      r0,r9
00003c  f7fffffe          BL       __aeabi_fmul
000040  4680              MOV      r8,r0
000042  4629              MOV      r1,r5
000044  f7fffffe          BL       __aeabi_fmul
000048  495e              LDR      r1,|L10.452|
00004a  6088              STR      r0,[r1,#8]  ; wz_speed_pid_v
00004c  495a              LDR      r1,|L10.440|
00004e  6208              STR      r0,[r1,#0x20]  ; userdata1
;;;222    		//wz_speed_pid_v.err_i += wz_speed_pid.ki *wz_speed_pid_v.err *T;
;;;223    		wz_speed_pid_v.err_i += wz_speed_pid.ki *( exp_z_speed - h_speed ) *T;//期望速度与实际速度误差积分
000050  4639              MOV      r1,r7
000052  4620              MOV      r0,r4
000054  f7fffffe          BL       __aeabi_fsub
000058  4682              MOV      r10,r0
00005a  4859              LDR      r0,|L10.448|
00005c  6881              LDR      r1,[r0,#8]  ; wz_speed_pid
00005e  4650              MOV      r0,r10
000060  f7fffffe          BL       __aeabi_fmul
000064  4681              MOV      r9,r0
000066  4629              MOV      r1,r5
000068  f7fffffe          BL       __aeabi_fmul
00006c  4680              MOV      r8,r0
00006e  4855              LDR      r0,|L10.452|
000070  68c1              LDR      r1,[r0,#0xc]  ; wz_speed_pid_v
000072  4640              MOV      r0,r8
000074  f7fffffe          BL       __aeabi_fadd
000078  4952              LDR      r1,|L10.452|
00007a  60c8              STR      r0,[r1,#0xc]  ; wz_speed_pid_v
;;;224    		wz_speed_pid_v.err_i = LIMIT(wz_speed_pid_v.err_i,-Thr_Weight *200,Thr_Weight *200);
00007c  4853              LDR      r0,|L10.460|
00007e  6800              LDR      r0,[r0,#0]  ; Thr_Weight
000080  f0804900          EOR      r9,r0,#0x80000000
000084  4952              LDR      r1,|L10.464|
000086  4648              MOV      r0,r9
000088  f7fffffe          BL       __aeabi_fmul
00008c  4680              MOV      r8,r0
00008e  484d              LDR      r0,|L10.452|
000090  68c1              LDR      r1,[r0,#0xc]  ; wz_speed_pid_v
000092  4640              MOV      r0,r8
000094  f7fffffe          BL       __aeabi_cfrcmple
000098  d208              BCS      |L10.172|
00009a  484c              LDR      r0,|L10.460|
00009c  6800              LDR      r0,[r0,#0]  ; Thr_Weight
00009e  f0804800          EOR      r8,r0,#0x80000000
0000a2  494b              LDR      r1,|L10.464|
0000a4  4640              MOV      r0,r8
0000a6  f7fffffe          BL       __aeabi_fmul
0000aa  e013              B        |L10.212|
                  |L10.172|
0000ac  4948              LDR      r1,|L10.464|
0000ae  4847              LDR      r0,|L10.460|
0000b0  6800              LDR      r0,[r0,#0]  ; Thr_Weight
0000b2  f7fffffe          BL       __aeabi_fmul
0000b6  4680              MOV      r8,r0
0000b8  4842              LDR      r0,|L10.452|
0000ba  68c1              LDR      r1,[r0,#0xc]  ; wz_speed_pid_v
0000bc  4640              MOV      r0,r8
0000be  f7fffffe          BL       __aeabi_cfcmple
0000c2  d205              BCS      |L10.208|
0000c4  4942              LDR      r1,|L10.464|
0000c6  4841              LDR      r0,|L10.460|
0000c8  6800              LDR      r0,[r0,#0]  ; Thr_Weight
0000ca  f7fffffe          BL       __aeabi_fmul
0000ce  e001              B        |L10.212|
                  |L10.208|
0000d0  483c              LDR      r0,|L10.452|
0000d2  68c0              LDR      r0,[r0,#0xc]  ; wz_speed_pid_v
                  |L10.212|
0000d4  493b              LDR      r1,|L10.452|
0000d6  60c8              STR      r0,[r1,#0xc]  ; wz_speed_pid_v
;;;225    		userdata1[9]=wz_speed_pid_v.err_i;
0000d8  4608              MOV      r0,r1
0000da  68c0              LDR      r0,[r0,#0xc]  ; wz_speed_pid_v
0000dc  4936              LDR      r1,|L10.440|
0000de  6248              STR      r0,[r1,#0x24]  ; userdata1
;;;226    		wz_speed_pid_v.pid_out = thr_keepheight + Thr_Weight *LIMIT((wz_speed_pid.kp *exp_z_speed + wz_speed_pid_v.err + wz_speed_pid_v.err_d + wz_speed_pid_v.err_i),-300,300);//积分原来没有乘wz_speed_pid.kp
0000e0  4937              LDR      r1,|L10.448|
0000e2  6808              LDR      r0,[r1,#0]  ; wz_speed_pid
0000e4  4621              MOV      r1,r4
0000e6  f7fffffe          BL       __aeabi_fmul
0000ea  9000              STR      r0,[sp,#0]
0000ec  4835              LDR      r0,|L10.452|
0000ee  6801              LDR      r1,[r0,#0]  ; wz_speed_pid_v
0000f0  9800              LDR      r0,[sp,#0]
0000f2  f7fffffe          BL       __aeabi_fadd
0000f6  4683              MOV      r11,r0
0000f8  4832              LDR      r0,|L10.452|
0000fa  6881              LDR      r1,[r0,#8]  ; wz_speed_pid_v
0000fc  4658              MOV      r0,r11
0000fe  f7fffffe          BL       __aeabi_fadd
000102  4682              MOV      r10,r0
000104  482f              LDR      r0,|L10.452|
000106  68c1              LDR      r1,[r0,#0xc]  ; wz_speed_pid_v
000108  4650              MOV      r0,r10
00010a  f7fffffe          BL       __aeabi_fadd
00010e  4681              MOV      r9,r0
000110  4930              LDR      r1,|L10.468|
000112  f7fffffe          BL       __aeabi_cfcmple
000116  d201              BCS      |L10.284|
000118  482e              LDR      r0,|L10.468|
00011a  e034              B        |L10.390|
                  |L10.284|
00011c  4928              LDR      r1,|L10.448|
00011e  6808              LDR      r0,[r1,#0]  ; wz_speed_pid
000120  4621              MOV      r1,r4
000122  f7fffffe          BL       __aeabi_fmul
000126  9000              STR      r0,[sp,#0]
000128  4826              LDR      r0,|L10.452|
00012a  6801              LDR      r1,[r0,#0]  ; wz_speed_pid_v
00012c  9800              LDR      r0,[sp,#0]
00012e  f7fffffe          BL       __aeabi_fadd
000132  4683              MOV      r11,r0
000134  4823              LDR      r0,|L10.452|
000136  6881              LDR      r1,[r0,#8]  ; wz_speed_pid_v
000138  4658              MOV      r0,r11
00013a  f7fffffe          BL       __aeabi_fadd
00013e  4682              MOV      r10,r0
000140  4820              LDR      r0,|L10.452|
000142  68c1              LDR      r1,[r0,#0xc]  ; wz_speed_pid_v
000144  4650              MOV      r0,r10
000146  f7fffffe          BL       __aeabi_fadd
00014a  4681              MOV      r9,r0
00014c  4922              LDR      r1,|L10.472|
00014e  f7fffffe          BL       __aeabi_cfrcmple
000152  d201              BCS      |L10.344|
000154  4820              LDR      r0,|L10.472|
000156  e016              B        |L10.390|
                  |L10.344|
000158  4919              LDR      r1,|L10.448|
00015a  6808              LDR      r0,[r1,#0]  ; wz_speed_pid
00015c  4621              MOV      r1,r4
00015e  f7fffffe          BL       __aeabi_fmul
000162  4683              MOV      r11,r0
000164  4817              LDR      r0,|L10.452|
000166  6801              LDR      r1,[r0,#0]  ; wz_speed_pid_v
000168  4658              MOV      r0,r11
00016a  f7fffffe          BL       __aeabi_fadd
00016e  4682              MOV      r10,r0
000170  4814              LDR      r0,|L10.452|
000172  6881              LDR      r1,[r0,#8]  ; wz_speed_pid_v
000174  4650              MOV      r0,r10
000176  f7fffffe          BL       __aeabi_fadd
00017a  4681              MOV      r9,r0
00017c  4811              LDR      r0,|L10.452|
00017e  68c1              LDR      r1,[r0,#0xc]  ; wz_speed_pid_v
000180  4648              MOV      r0,r9
000182  f7fffffe          BL       __aeabi_fadd
                  |L10.390|
000186  9001              STR      r0,[sp,#4]
000188  4810              LDR      r0,|L10.460|
00018a  6801              LDR      r1,[r0,#0]  ; Thr_Weight
00018c  9801              LDR      r0,[sp,#4]
00018e  f7fffffe          BL       __aeabi_fmul
000192  4680              MOV      r8,r0
000194  4631              MOV      r1,r6
000196  f7fffffe          BL       __aeabi_fadd
00019a  490a              LDR      r1,|L10.452|
00019c  6108              STR      r0,[r1,#0x10]  ; wz_speed_pid_v
;;;227    		userdata1[10]=wz_speed_pid_v.pid_out-thr_keepheight;
00019e  6908              LDR      r0,[r1,#0x10]  ; wz_speed_pid_v
0001a0  4631              MOV      r1,r6
0001a2  f7fffffe          BL       __aeabi_fsub
0001a6  4904              LDR      r1,|L10.440|
0001a8  6288              STR      r0,[r1,#0x28]  ; userdata1
;;;228    		wz_speed_pid_v.err_old = wz_speed_pid_v.err; 
0001aa  4806              LDR      r0,|L10.452|
0001ac  6800              LDR      r0,[r0,#0]  ; wz_speed_pid_v
0001ae  4905              LDR      r1,|L10.452|
0001b0  6048              STR      r0,[r1,#4]  ; wz_speed_pid_v
;;;229    }
0001b2  e8bd9ffc          POP      {r2-r12,pc}
;;;230    
                          ENDP

0001b6  0000              DCW      0x0000
                  |L10.440|
                          DCD      userdata1
                  |L10.444|
                          DCD      wz_speed
                  |L10.448|
                          DCD      wz_speed_pid
                  |L10.452|
                          DCD      wz_speed_pid_v
                  |L10.456|
                          DCD      tempacc_lpf
                  |L10.460|
                          DCD      Thr_Weight
                  |L10.464|
                          DCD      0x43480000
                  |L10.468|
                          DCD      0xc3960000
                  |L10.472|
                          DCD      0x43960000

                          AREA ||.bss||, DATA, NOINIT, ALIGN=2

                  ultra_ctrl
                          %        20
                  ultra_pid
                          %        12
                  wz_speed_pid_v
                          %        20
                  wz_speed_pid
                          %        12
                  ultra_wz_speed_pid
                          %        12
                  baro_wz_speed_pid
                          %        12
                  baro_speed_arr
                          %        44
                  acc_speed_arr
                          %        204
                  baro_ctrl
                          %        20
                  baro_pid
                          %        12

                          AREA ||.data||, DATA, ALIGN=2

                  height_ctrl_out
                          DCD      0x00000000
                  wz_acc
                          DCD      0x00000000
                  keepheight_thr
                          DCD      0x00000000
                  lock
00000c  00000000          DCB      0x00,0x00,0x00,0x00
                  exp_height_speed
                          DCD      0x00000000
                  exp_height
                          DCD      0x00000000
                  ultra_speed
                          DCD      0x00000000
                  ultra_speed_acc
                          DCD      0x00000000
                  ultra_dis_lpf
                          DCD      0x00000000
                  ultra_ctrl_out
                          DCD      0x00000000
                  wz_speed
                          DCD      0x00000000
                  wz_acc_mms2
                          DCD      0x00000000
                  tempacc_lpf
                          DCD      0x00000000
                  lock_spd_crl
000034  00000000          DCB      0x00,0x00,0x00,0x00
                  baro_height
                          DCD      0x00000000
                  baro_height_old
                          DCD      0x00000000
                  lock_BARO
000040  00000000          DCB      0x00,0x00,0x00,0x00
                  baro_dis_lpf
                          DCD      0x00000000
                  baro_dis_kalman
                          DCD      0x00000000
                  baro_ctrl_out
                          DCD      0x00000000
                  baro_cnt
                          DCD      0x00000000
                  acc_cnt
                          DCD      0x00000000
                  baro_speed
                          DCD      0x00000000
                  baro_speed_lpf
                          DCD      0x00000000
                  Pressure_groud
                          DCD      0x00000000
                  height_ctrl_start_f
000064  00000000          DCB      0x00,0x00,0x00,0x00
                  thr_lpf
                          DCD      0x00000000
                  height_thr
                          DCD      0x00000000
                  wz_acc_temp
                          DCD      0x00000000
                  wz_acc1
                          DCD      0x00000000
                  hc_speed_i
                          DCD      0x00000000
                  wz_speed_0
                          DCD      0x00000000
                  h_speed
                          DCD      0x00000000
